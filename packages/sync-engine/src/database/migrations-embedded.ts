// AUTO-GENERATED by scripts/build-functions.ts â€” do not edit manually.
// Run `tsx scripts/build-functions.ts` (or the build) to regenerate.

export type EmbeddedMigration = {
  name: string
  sql: string
}

export const embeddedMigrations: EmbeddedMigration[] = [
  {
    name: '0000_initial_migration.sql',
    sql: 'select 1;',
  },
  {
    name: '0001_products.sql',
    sql: 'create table if not exists "stripe"."products" (\n  "id" text primary key,\n  "object" text,\n  "active" boolean,\n  "description" text,\n  "metadata" jsonb,\n  "name" text,\n  "created" integer,\n  "images" jsonb,\n  "livemode" boolean,\n  "package_dimensions" jsonb,\n  "shippable" boolean,\n  "statement_descriptor" text,\n  "unit_label" text,\n  "updated" integer,\n  "url" text\n);\n',
  },
  {
    name: '0002_customers.sql',
    sql: 'create table if not exists "stripe"."customers" (\n  "id" text primary key,\n  "object" text,\n  "address" jsonb,\n  "description" text,\n  "email" text,\n  "metadata" jsonb,\n  "name" text,\n  "phone" text,\n  "shipping" jsonb,\n  "balance" integer,\n  "created" integer,\n  "currency" text,\n  "default_source" text,\n  "delinquent" boolean,\n  "discount" jsonb,\n  "invoice_prefix" text,\n  "invoice_settings" jsonb,\n  "livemode" boolean,\n  "next_invoice_sequence" integer,\n  "preferred_locales" jsonb,\n  "tax_exempt" text\n);\n',
  },
  {
    name: '0003_prices.sql',
    sql: 'DO $$\nBEGIN\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = \'pricing_type\') THEN\n        create type "stripe"."pricing_type" as enum (\'one_time\', \'recurring\');\n    END IF;\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = \'pricing_tiers\') THEN\n      create type "stripe"."pricing_tiers" as enum (\'graduated\', \'volume\');\n    END IF;\n    --more types here...\nEND\n$$;\n\n\ncreate table if not exists "stripe"."prices" (\n  "id" text primary key,\n  "object" text,\n  "active" boolean,\n  "currency" text,\n  "metadata" jsonb,\n  "nickname" text,\n  "recurring" jsonb,\n  "type" stripe.pricing_type,\n  "unit_amount" integer,\n  "billing_scheme" text,\n  "created" integer,\n  "livemode" boolean,\n  "lookup_key" text,\n  "tiers_mode" stripe.pricing_tiers,\n  "transform_quantity" jsonb,\n  "unit_amount_decimal" text,\n\n  "product" text references stripe.products\n);\n\n',
  },
  {
    name: '0004_subscriptions.sql',
    sql: '\nDO $$\nBEGIN\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = \'subscription_status\') THEN\n        create type "stripe"."subscription_status" as enum (\n          \'trialing\',\n          \'active\',\n          \'canceled\',\n          \'incomplete\',\n          \'incomplete_expired\',\n          \'past_due\',\n          \'unpaid\'\n        );\n    END IF;\nEND\n$$;\n\ncreate table if not exists "stripe"."subscriptions" (\n  "id" text primary key,\n  "object" text,\n  "cancel_at_period_end" boolean,\n  "current_period_end" integer,\n  "current_period_start" integer,\n  "default_payment_method" text,\n  "items" jsonb,\n  "metadata" jsonb,\n  "pending_setup_intent" text,\n  "pending_update" jsonb,\n  "status" "stripe"."subscription_status", \n  "application_fee_percent" double precision,\n  "billing_cycle_anchor" integer,\n  "billing_thresholds" jsonb,\n  "cancel_at" integer,\n  "canceled_at" integer,\n  "collection_method" text,\n  "created" integer,\n  "days_until_due" integer,\n  "default_source" text,\n  "default_tax_rates" jsonb,\n  "discount" jsonb,\n  "ended_at" integer,\n  "livemode" boolean,\n  "next_pending_invoice_item_invoice" integer,\n  "pause_collection" jsonb,\n  "pending_invoice_item_interval" jsonb,\n  "start_date" integer,\n  "transfer_data" jsonb,\n  "trial_end" jsonb,\n  "trial_start" jsonb,\n\n  "schedule" text,\n  "customer" text references "stripe"."customers",\n  "latest_invoice" text, -- not yet joined\n  "plan" text -- not yet joined\n);\n\n',
  },
  {
    name: '0005_invoices.sql',
    sql: '\nDO $$\nBEGIN\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = \'invoice_status\') THEN\n        create type "stripe"."invoice_status" as enum (\'draft\', \'open\', \'paid\', \'uncollectible\', \'void\');\n    END IF;\nEND\n$$;\n\n\ncreate table if not exists "stripe"."invoices" (\n  "id" text primary key,\n  "object" text,\n  "auto_advance" boolean,\n  "collection_method" text,\n  "currency" text,\n  "description" text,\n  "hosted_invoice_url" text,\n  "lines" jsonb,\n  "metadata" jsonb,\n  "period_end" integer,\n  "period_start" integer,\n  "status" "stripe"."invoice_status",\n  "total" bigint,\n  "account_country" text,\n  "account_name" text,\n  "account_tax_ids" jsonb,\n  "amount_due" bigint,\n  "amount_paid" bigint,\n  "amount_remaining" bigint,\n  "application_fee_amount" bigint,\n  "attempt_count" integer,\n  "attempted" boolean,\n  "billing_reason" text,\n  "created" integer,\n  "custom_fields" jsonb,\n  "customer_address" jsonb,\n  "customer_email" text,\n  "customer_name" text,\n  "customer_phone" text,\n  "customer_shipping" jsonb,\n  "customer_tax_exempt" text,\n  "customer_tax_ids" jsonb,\n  "default_tax_rates" jsonb,\n  "discount" jsonb,\n  "discounts" jsonb,\n  "due_date" integer,\n  "ending_balance" integer,\n  "footer" text,\n  "invoice_pdf" text,\n  "last_finalization_error" jsonb,\n  "livemode" boolean,\n  "next_payment_attempt" integer,\n  "number" text,\n  "paid" boolean,\n  "payment_settings" jsonb,\n  "post_payment_credit_notes_amount" integer,\n  "pre_payment_credit_notes_amount" integer,\n  "receipt_number" text,\n  "starting_balance" integer,\n  "statement_descriptor" text,\n  "status_transitions" jsonb,\n  "subtotal" integer,\n  "tax" integer,\n  "total_discount_amounts" jsonb,\n  "total_tax_amounts" jsonb,\n  "transfer_data" jsonb,\n  "webhooks_delivered_at" integer,\n\n  "customer" text references "stripe"."customers",\n  "subscription" text references "stripe"."subscriptions",\n  "payment_intent" text,  -- not yet implemented\n  "default_payment_method" text, -- not yet implemented\n  "default_source" text, -- not yet implemented\n  "on_behalf_of" text, -- not yet implemented\n  "charge" text -- not yet implemented\n);\n',
  },
  {
    name: '0006_charges.sql',
    sql: '\ncreate table if not exists "stripe".charges (\n    id text primary key,\n    object text,\n    card jsonb,\n    paid boolean,\n    "order" text,\n    amount bigint,\n    review text,\n    source jsonb,\n    status text,\n    created integer,\n    dispute text,\n    invoice text,\n    outcome jsonb,\n    refunds jsonb,\n    updated integer,\n    captured boolean,\n    currency text,\n    customer text,\n    livemode boolean,\n    metadata jsonb,\n    refunded boolean,\n    shipping jsonb,\n    application text,\n    description text,\n    destination text,\n    failure_code text,\n    on_behalf_of text,\n    fraud_details jsonb,\n    receipt_email text,\n    payment_intent text,\n    receipt_number text,\n    transfer_group text,\n    amount_refunded bigint,\n    application_fee text,\n    failure_message text,\n    source_transfer text,\n    balance_transaction text,\n    statement_descriptor text,\n    statement_description text,\n    payment_method_details jsonb\n);\n',
  },
  {
    name: '0007_coupons.sql',
    sql: 'create table if not exists "stripe".coupons (\n    id text primary key,\n    object text,\n    name text,\n    valid boolean,\n    created integer,\n    updated integer,\n    currency text,\n    duration text,\n    livemode boolean,\n    metadata jsonb,\n    redeem_by integer,\n    amount_off bigint,\n    percent_off double precision,\n    times_redeemed bigint,\n    max_redemptions bigint,\n    duration_in_months bigint,\n    percent_off_precise double precision\n);\n',
  },
  {
    name: '0008_disputes.sql',
    sql: 'create table if not exists "stripe".disputes (\n    id text primary key,\n    object text,\n    amount bigint,\n    charge text,\n    reason text,\n    status text,\n    created integer,\n    updated integer,\n    currency text,\n    evidence jsonb,\n    livemode boolean,\n    metadata jsonb,\n    evidence_details jsonb,\n    balance_transactions jsonb,\n    is_charge_refundable boolean\n);\n',
  },
  {
    name: '0009_events.sql',
    sql: 'create table if not exists "stripe".events (\n    id text primary key,\n    object text,\n    data jsonb,\n    type text,\n    created integer,\n    request text,\n    updated integer,\n    livemode boolean,\n    api_version text,\n    pending_webhooks bigint\n);\n',
  },
  {
    name: '0010_payouts.sql',
    sql: 'create table if not exists "stripe".payouts (\n    id text primary key,\n    object text,\n    date text,\n    type text,\n    amount bigint,\n    method text,\n    status text,\n    created integer,\n    updated integer,\n    currency text,\n    livemode boolean,\n    metadata jsonb,\n    automatic boolean,\n    recipient text,\n    description text,\n    destination text,\n    source_type text,\n    arrival_date text,\n    bank_account jsonb,\n    failure_code text,\n    transfer_group text,\n    amount_reversed bigint,\n    failure_message text,\n    source_transaction text,\n    balance_transaction text,\n    statement_descriptor text,\n    statement_description text,\n    failure_balance_transaction text\n);\n',
  },
  {
    name: '0011_plans.sql',
    sql: 'create table if not exists "stripe"."plans" (\n    id text primary key,\n    object text,\n    name text,\n    tiers jsonb,\n    active boolean,\n    amount bigint,\n    created integer,\n    product text,\n    updated integer,\n    currency text,\n    "interval" text,\n    livemode boolean,\n    metadata jsonb,\n    nickname text,\n    tiers_mode text,\n    usage_type text,\n    billing_scheme text,\n    interval_count bigint,\n    aggregate_usage text,\n    transform_usage text,\n    trial_period_days bigint,\n    statement_descriptor text,\n    statement_description text\n);\n',
  },
  {
    name: '0012_add_updated_at.sql',
    sql: "create or replace function set_updated_at() returns trigger\n    language plpgsql\nas\n$$\nbegin\n  new.updated_at = now();\n  return NEW;\nend;\n$$;\n\nalter table stripe.subscriptions\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.subscriptions\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.products\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.products\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.customers\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.customers\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.prices\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.prices\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.invoices\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.invoices\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.charges\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.charges\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.coupons\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.coupons\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.disputes\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.disputes\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.events\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.events\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.payouts\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.payouts\n    for each row\n    execute procedure set_updated_at();\n\nalter table stripe.plans\n    add updated_at timestamptz default timezone('utc'::text, now()) not null;\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.plans\n    for each row\n    execute procedure set_updated_at();\n",
  },
  {
    name: '0013_add_subscription_items.sql',
    sql: 'create table if not exists "stripe"."subscription_items" (\n  "id" text primary key,\n  "object" text,\n  "billing_thresholds" jsonb,\n  "created" integer,\n  "deleted" boolean,\n  "metadata" jsonb,\n  "quantity" integer,\n  "price" text references "stripe"."prices",\n  "subscription" text references "stripe"."subscriptions",\n  "tax_rates" jsonb\n);',
  },
  {
    name: '0014_migrate_subscription_items.sql',
    sql: 'WITH subscriptions AS (\n  select jsonb_array_elements(items->\'data\') as obj from "stripe"."subscriptions"\n)\ninsert into "stripe"."subscription_items"\nselect obj->>\'id\' as "id",\n  obj->>\'object\' as "object", \n  obj->\'billing_thresholds\' as "billing_thresholds", \n  (obj->>\'created\')::INTEGER as "created", \n  (obj->>\'deleted\')::BOOLEAN as "deleted", \n  obj->\'metadata\' as "metadata", \n  (obj->>\'quantity\')::INTEGER as "quantity", \n  (obj->\'price\'->>\'id\')::TEXT as "price", \n  obj->>\'subscription\' as "subscription", \n  obj->\'tax_rates\' as "tax_rates"\nfrom subscriptions\non conflict ("id") \ndo update set "id" = excluded."id",\n  "object" = excluded."object",\n  "billing_thresholds" = excluded."billing_thresholds",\n  "created" = excluded."created",\n  "deleted" = excluded."deleted",\n  "metadata" = excluded."metadata",\n  "quantity" = excluded."quantity",\n  "price" = excluded."price",\n  "subscription" = excluded."subscription",\n  "tax_rates" = excluded."tax_rates"',
  },
  {
    name: '0015_add_customer_deleted.sql',
    sql: 'alter table stripe.customers\n    add deleted boolean default false not null;',
  },
  {
    name: '0016_add_invoice_indexes.sql',
    sql: 'CREATE INDEX stripe_invoices_customer_idx ON "stripe"."invoices" USING btree (customer);\nCREATE INDEX stripe_invoices_subscription_idx ON "stripe"."invoices" USING btree (subscription);',
  },
  {
    name: '0017_drop_charges_unavailable_columns.sql',
    sql: '-- drop columns that are duplicated / not available anymore\n-- card is not available on webhook v.2020-03-02. We can get the detail from payment_method_details\n-- statement_description is not available on webhook v.2020-03-02\nalter table "stripe"."charges"\n    drop column if exists "card",\n    drop column if exists "statement_description";',
  },
  {
    name: '0018_setup_intents.sql',
    sql: 'create table if not exists "stripe"."setup_intents" (\n    id text primary key,\n    object text,\n    created integer,\n    customer text,\n    description text,\n    payment_method text,\n    status text,\n    usage text,\n    cancellation_reason text,\n    latest_attempt text,\n    mandate text,\n    single_use_mandate text,\n    on_behalf_of text\n);\n\nCREATE INDEX stripe_setup_intents_customer_idx ON "stripe"."setup_intents" USING btree (customer);',
  },
  {
    name: '0019_payment_methods.sql',
    sql: 'create table if not exists "stripe"."payment_methods" (\n    id text primary key,\n    object text,\n    created integer,\n    customer text,\n    type text,\n    billing_details jsonb,\n    metadata jsonb,\n    card jsonb\n);\n\nCREATE INDEX stripe_payment_methods_customer_idx ON "stripe"."payment_methods" USING btree (customer);',
  },
  {
    name: '0020_disputes_payment_intent_created_idx.sql',
    sql: 'ALTER TABLE "stripe"."disputes" ADD COLUMN IF NOT EXISTS payment_intent TEXT;\n\nCREATE INDEX IF NOT EXISTS stripe_dispute_created_idx ON "stripe"."disputes" USING btree (created);',
  },
  {
    name: '0021_payment_intent.sql',
    sql: 'create table if not exists "stripe"."payment_intents" (\n  id text primary key,\n  object text,\n  amount integer,\n  amount_capturable integer,\n  amount_details jsonb,\n  amount_received integer,\n  application text,\n  application_fee_amount integer,\n  automatic_payment_methods text,\n  canceled_at integer,\n  cancellation_reason text,\n  capture_method text,\n  client_secret text,\n  confirmation_method text,\n  created integer,\n  currency text,\n  customer text,\n  description text,\n  invoice text,\n  last_payment_error text,\n  livemode boolean,\n  metadata jsonb,\n  next_action text,\n  on_behalf_of text,\n  payment_method text,\n  payment_method_options jsonb,\n  payment_method_types jsonb,\n  processing text,\n  receipt_email text,\n  review text,\n  setup_future_usage text,\n  shipping jsonb,\n  statement_descriptor text,\n  statement_descriptor_suffix text,\n  status text,\n  transfer_data jsonb,\n  transfer_group text\n);\n\nCREATE INDEX stripe_payment_intents_customer_idx ON "stripe"."payment_intents" USING btree (customer);\nCREATE INDEX stripe_payment_intents_invoice_idx ON "stripe"."payment_intents" USING btree (invoice);',
  },
  {
    name: '0022_adjust_plans.sql',
    sql: 'ALTER TABLE if exists "stripe"."plans" DROP COLUMN name;\nALTER TABLE if exists "stripe"."plans" DROP COLUMN updated;\nALTER TABLE if exists "stripe"."plans" DROP COLUMN tiers;\nALTER TABLE if exists "stripe"."plans" DROP COLUMN statement_descriptor;\nALTER TABLE if exists "stripe"."plans" DROP COLUMN statement_description;',
  },
  {
    name: '0023_invoice_deleted.sql',
    sql: 'ALTER TYPE "stripe"."invoice_status" ADD VALUE \'deleted\';',
  },
  {
    name: '0024_subscription_schedules.sql',
    sql: "do $$\nBEGIN\n    IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'subscription_schedule_status') THEN\n        create type \"stripe\".\"subscription_schedule_status\" as enum ('not_started', 'active', 'completed', 'released', 'canceled');\n    END IF;\nEND\n$$;\n\ncreate table if not exists\n    \"stripe\".\"subscription_schedules\" (\n        id text primary key,\n        object text,\n        application text,\n        canceled_at integer,\n        completed_at integer,\n        created integer not null,\n        current_phase jsonb,\n        customer text not null,\n        default_settings jsonb,\n        end_behavior text,\n        livemode boolean not null,\n        metadata jsonb not null,\n        phases jsonb not null,\n        released_at integer,\n        released_subscription text,\n        status stripe.subscription_schedule_status not null,\n        subscription text,\n        test_clock text\n    );",
  },
  {
    name: '0025_tax_ids.sql',
    sql: 'create table if not exists\n  "stripe"."tax_ids" (\n    "id" text primary key,\n    "object" text,\n    "country" text,\n    "customer" text,\n    "type" text,\n    "value" text,\n    "created" integer not null,\n    "livemode" boolean,\n    "owner" jsonb\n  );\n\ncreate index stripe_tax_ids_customer_idx on "stripe"."tax_ids" using btree (customer);',
  },
  {
    name: '0026_credit_notes.sql',
    sql: 'create table if not exists\n  "stripe"."credit_notes" (\n    "id" text primary key,\n    object text,\n    amount integer,\n    amount_shipping integer,\n    created integer,\n    currency text,\n    customer text,\n    customer_balance_transaction text,\n    discount_amount integer,\n    discount_amounts jsonb,\n    invoice text,\n    lines jsonb,\n    livemode boolean,\n    memo text,\n    metadata jsonb,\n    number text,\n    out_of_band_amount integer,\n    pdf text,\n    reason text,\n    refund text,\n    shipping_cost jsonb,\n    status text,\n    subtotal integer,\n    subtotal_excluding_tax integer,\n    tax_amounts jsonb,\n    total integer,\n    total_excluding_tax integer,\n    type text,\n    voided_at text\n  );\n\ncreate index stripe_credit_notes_customer_idx on "stripe"."credit_notes" using btree (customer);\n\ncreate index stripe_credit_notes_invoice_idx on "stripe"."credit_notes" using btree (invoice);',
  },
  {
    name: '0027_add_marketing_features_to_products.sql',
    sql: 'ALTER TABLE IF EXISTS stripe.products ADD COLUMN IF NOT EXISTS marketing_features JSONB;\n\n',
  },
  {
    name: '0028_early_fraud_warning.sql',
    sql: 'create table\n    if not exists "stripe"."early_fraud_warnings" (\n        "id" text primary key,\n        object text,\n        actionable boolean,\n        charge text,\n        created integer,\n        fraud_type text,\n        livemode boolean,\n        payment_intent text,\n        updated_at timestamptz default timezone(\'utc\'::text, now()) not null\n    );\n\ncreate index stripe_early_fraud_warnings_charge_idx on "stripe"."early_fraud_warnings" using btree (charge);\n\ncreate index stripe_early_fraud_warnings_payment_intent_idx on "stripe"."early_fraud_warnings" using btree (payment_intent);\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.early_fraud_warnings\n    for each row\n    execute procedure set_updated_at();\n',
  },
  {
    name: '0029_reviews.sql',
    sql: 'create table\n    if not exists "stripe"."reviews" (\n        "id" text primary key,\n        object text,\n        billing_zip text,\n        charge text,\n        created integer,\n        closed_reason text,\n        livemode boolean,\n        ip_address text,\n        ip_address_location jsonb,\n        open boolean,\n        opened_reason text,\n        payment_intent text,\n        reason text,\n        session text,\n        updated_at timestamptz default timezone(\'utc\'::text, now()) not null\n    );\n\ncreate index stripe_reviews_charge_idx on "stripe"."reviews" using btree (charge);\n\ncreate index stripe_reviews_payment_intent_idx on "stripe"."reviews" using btree (payment_intent);\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.reviews\n    for each row\n    execute procedure set_updated_at();\n',
  },
  {
    name: '0030_refunds.sql',
    sql: 'create table\n    if not exists "stripe"."refunds" (\n        "id" text primary key,\n        object text,\n        amount integer,\n        balance_transaction text,\n        charge text,\n        created integer,\n        currency text,\n        destination_details jsonb,\n        metadata jsonb,\n        payment_intent text,\n        reason text,\n        receipt_number text,\n        source_transfer_reversal text,\n        status text,\n        transfer_reversal text,\n        updated_at timestamptz default timezone(\'utc\'::text, now()) not null\n    );\n\ncreate index stripe_refunds_charge_idx on "stripe"."refunds" using btree (charge);\n\ncreate index stripe_refunds_payment_intent_idx on "stripe"."refunds" using btree (payment_intent);\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.refunds\n    for each row\n    execute procedure set_updated_at();\n',
  },
  {
    name: '0031_add_default_price.sql',
    sql: 'alter table "stripe"."products"\nadd column IF NOT EXISTS "default_price" text;\n',
  },
  {
    name: '0032_update_subscription_items.sql',
    sql: 'ALTER TABLE "stripe"."subscription_items"\nADD COLUMN IF NOT EXISTS "current_period_end" integer,\nADD COLUMN IF NOT EXISTS "current_period_start" integer;\n',
  },
  {
    name: '0033_add_last_synced_at.sql',
    sql: '-- Add last_synced_at column to all Stripe tables for tracking sync status\n\n-- Charges\nalter table "stripe"."charges"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Coupons\nalter table "stripe"."coupons"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Credit Notes\nalter table "stripe"."credit_notes"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Customers\nalter table "stripe"."customers"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Disputes\nalter table "stripe"."disputes"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Early Fraud Warnings\nalter table "stripe"."early_fraud_warnings"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Events\nalter table "stripe"."events"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Invoices\nalter table "stripe"."invoices"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Payment Intents\nalter table "stripe"."payment_intents"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Payment Methods\nalter table "stripe"."payment_methods"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Payouts\nalter table "stripe"."payouts"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Plans\nalter table "stripe"."plans"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Prices\nalter table "stripe"."prices"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Products\nalter table "stripe"."products"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Refunds\nalter table "stripe"."refunds"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Reviews\nalter table "stripe"."reviews"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Setup Intents\nalter table "stripe"."setup_intents"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Subscription Items\nalter table "stripe"."subscription_items"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Subscription Schedules\nalter table "stripe"."subscription_schedules"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Subscriptions\nalter table "stripe"."subscriptions"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n\n-- Tax IDs\nalter table "stripe"."tax_ids"\nadd column IF NOT EXISTS "last_synced_at" timestamptz;\n',
  },
  {
    name: '0034_remove_foreign_keys.sql',
    sql: '-- Remove all foreign key constraints\n\nALTER TABLE "stripe"."subscriptions" DROP CONSTRAINT IF EXISTS "subscriptions_customer_fkey";\n\nALTER TABLE "stripe"."prices" DROP CONSTRAINT IF EXISTS "prices_product_fkey";\n\nALTER TABLE "stripe"."invoices" DROP CONSTRAINT IF EXISTS "invoices_customer_fkey";\n\nALTER TABLE "stripe"."invoices" DROP CONSTRAINT IF EXISTS "invoices_subscription_fkey";\n\nALTER TABLE "stripe"."subscription_items" DROP CONSTRAINT IF EXISTS "subscription_items_price_fkey";\n\nALTER TABLE "stripe"."subscription_items" DROP CONSTRAINT IF EXISTS "subscription_items_subscription_fkey";\n',
  },
  {
    name: '0035_checkout_sessions.sql',
    sql: 'create table\n    if not exists "stripe"."checkout_sessions" (\n        "id" text primary key,\n        "object" text,\n        "adaptive_pricing" jsonb,\n        "after_expiration" jsonb,\n        "allow_promotion_codes" boolean,\n        "amount_subtotal" integer,\n        "amount_total" integer,\n        "automatic_tax" jsonb,\n        "billing_address_collection" text,\n        "cancel_url" text,\n        "client_reference_id" text,\n        "client_secret" text,\n        "collected_information" jsonb,\n        "consent" jsonb,\n        "consent_collection" jsonb,\n        "created" integer,\n        "currency" text,\n        "currency_conversion" jsonb,\n        "custom_fields" jsonb,\n        "custom_text" jsonb,\n        "customer" text,\n        "customer_creation" text,\n        "customer_details" jsonb,\n        "customer_email" text,\n        "discounts" jsonb,\n        "expires_at" integer,\n        "invoice" text,\n        "invoice_creation" jsonb,\n        "livemode" boolean,\n        "locale" text,\n        "metadata" jsonb,\n        "mode" text,\n        "optional_items" jsonb,\n        "payment_intent" text,\n        "payment_link" text,\n        "payment_method_collection" text,\n        "payment_method_configuration_details" jsonb,\n        "payment_method_options" jsonb,\n        "payment_method_types" jsonb,\n        "payment_status" text,\n        "permissions" jsonb,\n        "phone_number_collection" jsonb,\n        "presentment_details" jsonb,\n        "recovered_from" text,\n        "redirect_on_completion" text,\n        "return_url" text,\n        "saved_payment_method_options" jsonb,\n        "setup_intent" text,\n        "shipping_address_collection" jsonb,\n        "shipping_cost" jsonb,\n        "shipping_details" jsonb,\n        "shipping_options" jsonb,\n        "status" text,\n        "submit_type" text,\n        "subscription" text,\n        "success_url" text,\n        "tax_id_collection" jsonb,\n        "total_details" jsonb,\n        "ui_mode" text,\n        "url" text,\n        "wallet_options" jsonb,\n        "updated_at" timestamptz default timezone(\'utc\'::text, now()) not null,\n        "last_synced_at" timestamptz\n    );\n\ncreate index stripe_checkout_sessions_customer_idx on "stripe"."checkout_sessions" using btree (customer);\ncreate index stripe_checkout_sessions_subscription_idx on "stripe"."checkout_sessions" using btree (subscription);\ncreate index stripe_checkout_sessions_payment_intent_idx on "stripe"."checkout_sessions" using btree (payment_intent);\ncreate index stripe_checkout_sessions_invoice_idx on "stripe"."checkout_sessions" using btree (invoice);\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.checkout_sessions\n    for each row\n    execute procedure set_updated_at();\n',
  },
  {
    name: '0036_checkout_session_line_items.sql',
    sql: 'create table if not exists "stripe"."checkout_session_line_items" (\n  "id" text primary key,\n  "object" text,\n  "amount_discount" integer,\n  "amount_subtotal" integer,\n  "amount_tax" integer,\n  "amount_total" integer,\n  "currency" text,\n  "description" text,\n  "price" text references "stripe"."prices" on delete cascade,\n  "quantity" integer,\n  "checkout_session" text references "stripe"."checkout_sessions" on delete cascade,\n  "updated_at" timestamptz default timezone(\'utc\'::text, now()) not null,\n  "last_synced_at" timestamptz\n);\n\ncreate index stripe_checkout_session_line_items_session_idx on "stripe"."checkout_session_line_items" using btree (checkout_session);\ncreate index stripe_checkout_session_line_items_price_idx on "stripe"."checkout_session_line_items" using btree (price);\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.checkout_session_line_items\n    for each row\n    execute procedure set_updated_at(); ',
  },
  {
    name: '0037_add_features.sql',
    sql: 'create table\n    if not exists "stripe"."features" (\n        "id" text primary key,\n        object text,\n        livemode boolean,\n        name text,\n        lookup_key text unique,\n        active boolean,\n        metadata jsonb,\n        updated_at timestamptz default timezone(\'utc\'::text, now()) not null,\n        last_synced_at timestamptz\n    );\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.features\n    for each row\n    execute procedure set_updated_at();\n',
  },
  {
    name: '0038_active_entitlement.sql',
    sql: 'create table\n    if not exists "stripe"."active_entitlements" (\n        "id" text primary key,\n        "object" text,\n        "livemode" boolean,\n        "feature" text,\n        "customer" text,\n        "lookup_key" text unique,\n        "updated_at" timestamptz default timezone(\'utc\'::text, now()) not null,\n        "last_synced_at" timestamptz\n    );\n\ncreate index stripe_active_entitlements_customer_idx on "stripe"."active_entitlements" using btree (customer);\ncreate index stripe_active_entitlements_feature_idx on "stripe"."active_entitlements" using btree (feature);\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.active_entitlements\n    for each row\n    execute procedure set_updated_at();\n',
  },
  {
    name: '0039_add_paused_to_subscription_status.sql',
    sql: 'ALTER TYPE "stripe"."subscription_status" ADD VALUE \'paused\';',
  },
  {
    name: '0040_managed_webhooks.sql',
    sql: 'create table\n    if not exists "stripe"."managed_webhooks" (\n        "id" text primary key,\n        "object" text,\n        "uuid" text unique not null,\n        "url" text not null,\n        "enabled_events" jsonb not null,\n        "description" text,\n        "enabled" boolean,\n        "livemode" boolean,\n        "metadata" jsonb,\n        "secret" text not null,\n        "status" text,\n        "api_version" text,\n        "created" integer,\n        "updated_at" timestamptz default timezone(\'utc\'::text, now()) not null,\n        "last_synced_at" timestamptz\n    );\n\ncreate index stripe_managed_webhooks_uuid_idx on "stripe"."managed_webhooks" using btree (uuid);\ncreate index stripe_managed_webhooks_status_idx on "stripe"."managed_webhooks" using btree (status);\ncreate index stripe_managed_webhooks_enabled_idx on "stripe"."managed_webhooks" using btree (enabled);\n\ncreate trigger handle_updated_at\n    before update\n    on stripe.managed_webhooks\n    for each row\n    execute procedure set_updated_at();\n',
  },
  {
    name: '0041_rename_managed_webhooks.sql',
    sql: '-- Rename managed_webhooks table to _managed_webhooks\nalter table if exists "stripe"."managed_webhooks" rename to "_managed_webhooks";\n',
  },
  {
    name: '0042_convert_to_jsonb_generated_columns.sql',
    sql: '-- Convert all tables to use jsonb raw_data as source of truth with generated columns\n-- This migration adds raw_data column and converts all existing columns to generated columns\n\n-- ============================================================================\n-- ACTIVE_ENTITLEMENTS\n-- ============================================================================\n\n-- Add raw_data column\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes (will be recreated on generated columns)\nDROP INDEX IF EXISTS "stripe"."stripe_active_entitlements_customer_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_active_entitlements_feature_idx";\n\n-- Drop unique constraint (will be recreated on generated column)\nALTER TABLE "stripe"."active_entitlements" DROP CONSTRAINT IF EXISTS "active_entitlements_lookup_key_key";\n\n-- Drop existing columns and recreate as generated columns\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "feature";\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "feature" text GENERATED ALWAYS AS ((raw_data->>\'feature\')::text) STORED;\n\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "lookup_key";\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "lookup_key" text GENERATED ALWAYS AS ((raw_data->>\'lookup_key\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_active_entitlements_customer_idx ON "stripe"."active_entitlements" USING btree (customer);\nCREATE INDEX stripe_active_entitlements_feature_idx ON "stripe"."active_entitlements" USING btree (feature);\n\n-- Recreate unique constraint\nCREATE UNIQUE INDEX active_entitlements_lookup_key_key ON "stripe"."active_entitlements" (lookup_key) WHERE lookup_key IS NOT NULL;\n\n-- ============================================================================\n-- CHARGES\n-- ============================================================================\n\nALTER TABLE "stripe"."charges" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."charges" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "paid";\nALTER TABLE "stripe"."charges" ADD COLUMN "paid" boolean GENERATED ALWAYS AS ((raw_data->>\'paid\')::boolean) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "order";\nALTER TABLE "stripe"."charges" ADD COLUMN "order" text GENERATED ALWAYS AS ((raw_data->>\'order\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."charges" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((raw_data->>\'amount\')::bigint) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "review";\nALTER TABLE "stripe"."charges" ADD COLUMN "review" text GENERATED ALWAYS AS ((raw_data->>\'review\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "source";\nALTER TABLE "stripe"."charges" ADD COLUMN "source" jsonb GENERATED ALWAYS AS (raw_data->\'source\') STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."charges" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."charges" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "dispute";\nALTER TABLE "stripe"."charges" ADD COLUMN "dispute" text GENERATED ALWAYS AS ((raw_data->>\'dispute\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "invoice";\nALTER TABLE "stripe"."charges" ADD COLUMN "invoice" text GENERATED ALWAYS AS ((raw_data->>\'invoice\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "outcome";\nALTER TABLE "stripe"."charges" ADD COLUMN "outcome" jsonb GENERATED ALWAYS AS (raw_data->\'outcome\') STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "refunds";\nALTER TABLE "stripe"."charges" ADD COLUMN "refunds" jsonb GENERATED ALWAYS AS (raw_data->\'refunds\') STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."charges" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((raw_data->>\'updated\')::integer) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "captured";\nALTER TABLE "stripe"."charges" ADD COLUMN "captured" boolean GENERATED ALWAYS AS ((raw_data->>\'captured\')::boolean) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."charges" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."charges" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."charges" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."charges" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "refunded";\nALTER TABLE "stripe"."charges" ADD COLUMN "refunded" boolean GENERATED ALWAYS AS ((raw_data->>\'refunded\')::boolean) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "shipping";\nALTER TABLE "stripe"."charges" ADD COLUMN "shipping" jsonb GENERATED ALWAYS AS (raw_data->\'shipping\') STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "application";\nALTER TABLE "stripe"."charges" ADD COLUMN "application" text GENERATED ALWAYS AS ((raw_data->>\'application\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."charges" ADD COLUMN "description" text GENERATED ALWAYS AS ((raw_data->>\'description\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "destination";\nALTER TABLE "stripe"."charges" ADD COLUMN "destination" text GENERATED ALWAYS AS ((raw_data->>\'destination\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "failure_code";\nALTER TABLE "stripe"."charges" ADD COLUMN "failure_code" text GENERATED ALWAYS AS ((raw_data->>\'failure_code\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "on_behalf_of";\nALTER TABLE "stripe"."charges" ADD COLUMN "on_behalf_of" text GENERATED ALWAYS AS ((raw_data->>\'on_behalf_of\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "fraud_details";\nALTER TABLE "stripe"."charges" ADD COLUMN "fraud_details" jsonb GENERATED ALWAYS AS (raw_data->\'fraud_details\') STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "receipt_email";\nALTER TABLE "stripe"."charges" ADD COLUMN "receipt_email" text GENERATED ALWAYS AS ((raw_data->>\'receipt_email\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."charges" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((raw_data->>\'payment_intent\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "receipt_number";\nALTER TABLE "stripe"."charges" ADD COLUMN "receipt_number" text GENERATED ALWAYS AS ((raw_data->>\'receipt_number\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "transfer_group";\nALTER TABLE "stripe"."charges" ADD COLUMN "transfer_group" text GENERATED ALWAYS AS ((raw_data->>\'transfer_group\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "amount_refunded";\nALTER TABLE "stripe"."charges" ADD COLUMN "amount_refunded" bigint GENERATED ALWAYS AS ((raw_data->>\'amount_refunded\')::bigint) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "application_fee";\nALTER TABLE "stripe"."charges" ADD COLUMN "application_fee" text GENERATED ALWAYS AS ((raw_data->>\'application_fee\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "failure_message";\nALTER TABLE "stripe"."charges" ADD COLUMN "failure_message" text GENERATED ALWAYS AS ((raw_data->>\'failure_message\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "source_transfer";\nALTER TABLE "stripe"."charges" ADD COLUMN "source_transfer" text GENERATED ALWAYS AS ((raw_data->>\'source_transfer\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "balance_transaction";\nALTER TABLE "stripe"."charges" ADD COLUMN "balance_transaction" text GENERATED ALWAYS AS ((raw_data->>\'balance_transaction\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."charges" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((raw_data->>\'statement_descriptor\')::text) STORED;\n\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "payment_method_details";\nALTER TABLE "stripe"."charges" ADD COLUMN "payment_method_details" jsonb GENERATED ALWAYS AS (raw_data->\'payment_method_details\') STORED;\n\n-- ============================================================================\n-- CHECKOUT_SESSION_LINE_ITEMS\n-- ============================================================================\n\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_checkout_session_line_items_session_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_checkout_session_line_items_price_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "amount_discount";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_discount" integer GENERATED ALWAYS AS ((raw_data->>\'amount_discount\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "amount_subtotal";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_subtotal" integer GENERATED ALWAYS AS ((raw_data->>\'amount_subtotal\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "amount_tax";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_tax" integer GENERATED ALWAYS AS ((raw_data->>\'amount_tax\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "amount_total";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_total" integer GENERATED ALWAYS AS ((raw_data->>\'amount_total\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "description" text GENERATED ALWAYS AS ((raw_data->>\'description\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "price";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "price" text GENERATED ALWAYS AS ((raw_data->>\'price\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "quantity";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "quantity" integer GENERATED ALWAYS AS ((raw_data->>\'quantity\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "checkout_session";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "checkout_session" text GENERATED ALWAYS AS ((raw_data->>\'checkout_session\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_checkout_session_line_items_session_idx ON "stripe"."checkout_session_line_items" USING btree (checkout_session);\nCREATE INDEX stripe_checkout_session_line_items_price_idx ON "stripe"."checkout_session_line_items" USING btree (price);\n\n-- ============================================================================\n-- CHECKOUT_SESSIONS\n-- ============================================================================\n\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_checkout_sessions_customer_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_checkout_sessions_subscription_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_checkout_sessions_payment_intent_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_checkout_sessions_invoice_idx";\n\n-- Drop and recreate columns as generated (all columns from checkoutSessionSchema)\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "adaptive_pricing";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "adaptive_pricing" jsonb GENERATED ALWAYS AS (raw_data->\'adaptive_pricing\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "after_expiration";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "after_expiration" jsonb GENERATED ALWAYS AS (raw_data->\'after_expiration\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "allow_promotion_codes";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "allow_promotion_codes" boolean GENERATED ALWAYS AS ((raw_data->>\'allow_promotion_codes\')::boolean) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "amount_subtotal";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "amount_subtotal" integer GENERATED ALWAYS AS ((raw_data->>\'amount_subtotal\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "amount_total";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "amount_total" integer GENERATED ALWAYS AS ((raw_data->>\'amount_total\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "automatic_tax";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "automatic_tax" jsonb GENERATED ALWAYS AS (raw_data->\'automatic_tax\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "billing_address_collection";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "billing_address_collection" text GENERATED ALWAYS AS ((raw_data->>\'billing_address_collection\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "cancel_url";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "cancel_url" text GENERATED ALWAYS AS ((raw_data->>\'cancel_url\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "client_reference_id";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "client_reference_id" text GENERATED ALWAYS AS ((raw_data->>\'client_reference_id\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "client_secret";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "client_secret" text GENERATED ALWAYS AS ((raw_data->>\'client_secret\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "collected_information";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "collected_information" jsonb GENERATED ALWAYS AS (raw_data->\'collected_information\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "consent";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "consent" jsonb GENERATED ALWAYS AS (raw_data->\'consent\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "consent_collection";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "consent_collection" jsonb GENERATED ALWAYS AS (raw_data->\'consent_collection\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "currency_conversion";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "currency_conversion" jsonb GENERATED ALWAYS AS (raw_data->\'currency_conversion\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "custom_fields";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "custom_fields" jsonb GENERATED ALWAYS AS (raw_data->\'custom_fields\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "custom_text";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "custom_text" jsonb GENERATED ALWAYS AS (raw_data->\'custom_text\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "customer_creation";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "customer_creation" text GENERATED ALWAYS AS ((raw_data->>\'customer_creation\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "customer_details";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "customer_details" jsonb GENERATED ALWAYS AS (raw_data->\'customer_details\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "customer_email";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "customer_email" text GENERATED ALWAYS AS ((raw_data->>\'customer_email\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "discounts";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "discounts" jsonb GENERATED ALWAYS AS (raw_data->\'discounts\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "expires_at";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "expires_at" integer GENERATED ALWAYS AS ((raw_data->>\'expires_at\')::integer) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "invoice";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "invoice" text GENERATED ALWAYS AS ((raw_data->>\'invoice\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "invoice_creation";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "invoice_creation" jsonb GENERATED ALWAYS AS (raw_data->\'invoice_creation\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "locale";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "locale" text GENERATED ALWAYS AS ((raw_data->>\'locale\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "mode";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "mode" text GENERATED ALWAYS AS ((raw_data->>\'mode\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "optional_items";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "optional_items" jsonb GENERATED ALWAYS AS (raw_data->\'optional_items\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((raw_data->>\'payment_intent\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_link";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_link" text GENERATED ALWAYS AS ((raw_data->>\'payment_link\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_method_collection";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_method_collection" text GENERATED ALWAYS AS ((raw_data->>\'payment_method_collection\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_method_configuration_details";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_method_configuration_details" jsonb GENERATED ALWAYS AS (raw_data->\'payment_method_configuration_details\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_method_options";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_method_options" jsonb GENERATED ALWAYS AS (raw_data->\'payment_method_options\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_method_types";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_method_types" jsonb GENERATED ALWAYS AS (raw_data->\'payment_method_types\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_status";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_status" text GENERATED ALWAYS AS ((raw_data->>\'payment_status\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "permissions";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "permissions" jsonb GENERATED ALWAYS AS (raw_data->\'permissions\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "phone_number_collection";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "phone_number_collection" jsonb GENERATED ALWAYS AS (raw_data->\'phone_number_collection\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "presentment_details";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "presentment_details" jsonb GENERATED ALWAYS AS (raw_data->\'presentment_details\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "recovered_from";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "recovered_from" text GENERATED ALWAYS AS ((raw_data->>\'recovered_from\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "redirect_on_completion";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "redirect_on_completion" text GENERATED ALWAYS AS ((raw_data->>\'redirect_on_completion\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "return_url";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "return_url" text GENERATED ALWAYS AS ((raw_data->>\'return_url\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "saved_payment_method_options";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "saved_payment_method_options" jsonb GENERATED ALWAYS AS (raw_data->\'saved_payment_method_options\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "setup_intent";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "setup_intent" text GENERATED ALWAYS AS ((raw_data->>\'setup_intent\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "shipping_address_collection";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "shipping_address_collection" jsonb GENERATED ALWAYS AS (raw_data->\'shipping_address_collection\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "shipping_cost";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "shipping_cost" jsonb GENERATED ALWAYS AS (raw_data->\'shipping_cost\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "shipping_details";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "shipping_details" jsonb GENERATED ALWAYS AS (raw_data->\'shipping_details\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "shipping_options";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "shipping_options" jsonb GENERATED ALWAYS AS (raw_data->\'shipping_options\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "submit_type";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "submit_type" text GENERATED ALWAYS AS ((raw_data->>\'submit_type\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "subscription";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "subscription" text GENERATED ALWAYS AS ((raw_data->>\'subscription\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "success_url";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "success_url" text GENERATED ALWAYS AS ((raw_data->>\'success_url\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "tax_id_collection";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "tax_id_collection" jsonb GENERATED ALWAYS AS (raw_data->\'tax_id_collection\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "total_details";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "total_details" jsonb GENERATED ALWAYS AS (raw_data->\'total_details\') STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "ui_mode";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "ui_mode" text GENERATED ALWAYS AS ((raw_data->>\'ui_mode\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "url";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "url" text GENERATED ALWAYS AS ((raw_data->>\'url\')::text) STORED;\n\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "wallet_options";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "wallet_options" jsonb GENERATED ALWAYS AS (raw_data->\'wallet_options\') STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_checkout_sessions_customer_idx ON "stripe"."checkout_sessions" USING btree (customer);\nCREATE INDEX stripe_checkout_sessions_subscription_idx ON "stripe"."checkout_sessions" USING btree (subscription);\nCREATE INDEX stripe_checkout_sessions_payment_intent_idx ON "stripe"."checkout_sessions" USING btree (payment_intent);\nCREATE INDEX stripe_checkout_sessions_invoice_idx ON "stripe"."checkout_sessions" USING btree (invoice);\n\n-- ============================================================================\n-- COUPONS\n-- ============================================================================\n\nALTER TABLE "stripe"."coupons" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."coupons" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."coupons" ADD COLUMN "name" text GENERATED ALWAYS AS ((raw_data->>\'name\')::text) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "valid";\nALTER TABLE "stripe"."coupons" ADD COLUMN "valid" boolean GENERATED ALWAYS AS ((raw_data->>\'valid\')::boolean) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."coupons" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."coupons" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((raw_data->>\'updated\')::integer) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."coupons" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "duration";\nALTER TABLE "stripe"."coupons" ADD COLUMN "duration" text GENERATED ALWAYS AS ((raw_data->>\'duration\')::text) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."coupons" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."coupons" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "redeem_by";\nALTER TABLE "stripe"."coupons" ADD COLUMN "redeem_by" integer GENERATED ALWAYS AS ((raw_data->>\'redeem_by\')::integer) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "amount_off";\nALTER TABLE "stripe"."coupons" ADD COLUMN "amount_off" bigint GENERATED ALWAYS AS ((raw_data->>\'amount_off\')::bigint) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "percent_off";\nALTER TABLE "stripe"."coupons" ADD COLUMN "percent_off" double precision GENERATED ALWAYS AS ((raw_data->>\'percent_off\')::double precision) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "times_redeemed";\nALTER TABLE "stripe"."coupons" ADD COLUMN "times_redeemed" bigint GENERATED ALWAYS AS ((raw_data->>\'times_redeemed\')::bigint) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "max_redemptions";\nALTER TABLE "stripe"."coupons" ADD COLUMN "max_redemptions" bigint GENERATED ALWAYS AS ((raw_data->>\'max_redemptions\')::bigint) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "duration_in_months";\nALTER TABLE "stripe"."coupons" ADD COLUMN "duration_in_months" bigint GENERATED ALWAYS AS ((raw_data->>\'duration_in_months\')::bigint) STORED;\n\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "percent_off_precise";\nALTER TABLE "stripe"."coupons" ADD COLUMN "percent_off_precise" double precision GENERATED ALWAYS AS ((raw_data->>\'percent_off_precise\')::double precision) STORED;\n\n-- ============================================================================\n-- CREDIT_NOTES\n-- ============================================================================\n\nALTER TABLE "stripe"."credit_notes" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_credit_notes_customer_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_credit_notes_invoice_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "amount" integer GENERATED ALWAYS AS ((raw_data->>\'amount\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "amount_shipping";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "amount_shipping" integer GENERATED ALWAYS AS ((raw_data->>\'amount_shipping\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "customer_balance_transaction";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "customer_balance_transaction" text GENERATED ALWAYS AS ((raw_data->>\'customer_balance_transaction\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "discount_amount";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "discount_amount" integer GENERATED ALWAYS AS ((raw_data->>\'discount_amount\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "discount_amounts";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "discount_amounts" jsonb GENERATED ALWAYS AS (raw_data->\'discount_amounts\') STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "invoice";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "invoice" text GENERATED ALWAYS AS ((raw_data->>\'invoice\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "lines";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "lines" jsonb GENERATED ALWAYS AS (raw_data->\'lines\') STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "memo";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "memo" text GENERATED ALWAYS AS ((raw_data->>\'memo\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "number";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "number" text GENERATED ALWAYS AS ((raw_data->>\'number\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "out_of_band_amount";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "out_of_band_amount" integer GENERATED ALWAYS AS ((raw_data->>\'out_of_band_amount\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "pdf";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "pdf" text GENERATED ALWAYS AS ((raw_data->>\'pdf\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "reason";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "reason" text GENERATED ALWAYS AS ((raw_data->>\'reason\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "refund";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "refund" text GENERATED ALWAYS AS ((raw_data->>\'refund\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "shipping_cost";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "shipping_cost" jsonb GENERATED ALWAYS AS (raw_data->\'shipping_cost\') STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "subtotal";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "subtotal" integer GENERATED ALWAYS AS ((raw_data->>\'subtotal\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "subtotal_excluding_tax";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "subtotal_excluding_tax" integer GENERATED ALWAYS AS ((raw_data->>\'subtotal_excluding_tax\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "tax_amounts";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "tax_amounts" jsonb GENERATED ALWAYS AS (raw_data->\'tax_amounts\') STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "total";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "total" integer GENERATED ALWAYS AS ((raw_data->>\'total\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "total_excluding_tax";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "total_excluding_tax" integer GENERATED ALWAYS AS ((raw_data->>\'total_excluding_tax\')::integer) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "type" text GENERATED ALWAYS AS ((raw_data->>\'type\')::text) STORED;\n\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "voided_at";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "voided_at" text GENERATED ALWAYS AS ((raw_data->>\'voided_at\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_credit_notes_customer_idx ON "stripe"."credit_notes" USING btree (customer);\nCREATE INDEX stripe_credit_notes_invoice_idx ON "stripe"."credit_notes" USING btree (invoice);\n\n-- ============================================================================\n-- CUSTOMERS\n-- ============================================================================\n\nALTER TABLE "stripe"."customers" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."customers" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "address";\nALTER TABLE "stripe"."customers" ADD COLUMN "address" jsonb GENERATED ALWAYS AS (raw_data->\'address\') STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."customers" ADD COLUMN "description" text GENERATED ALWAYS AS ((raw_data->>\'description\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "email";\nALTER TABLE "stripe"."customers" ADD COLUMN "email" text GENERATED ALWAYS AS ((raw_data->>\'email\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."customers" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."customers" ADD COLUMN "name" text GENERATED ALWAYS AS ((raw_data->>\'name\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "phone";\nALTER TABLE "stripe"."customers" ADD COLUMN "phone" text GENERATED ALWAYS AS ((raw_data->>\'phone\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "shipping";\nALTER TABLE "stripe"."customers" ADD COLUMN "shipping" jsonb GENERATED ALWAYS AS (raw_data->\'shipping\') STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "balance";\nALTER TABLE "stripe"."customers" ADD COLUMN "balance" integer GENERATED ALWAYS AS ((raw_data->>\'balance\')::integer) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."customers" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."customers" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "default_source";\nALTER TABLE "stripe"."customers" ADD COLUMN "default_source" text GENERATED ALWAYS AS ((raw_data->>\'default_source\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "delinquent";\nALTER TABLE "stripe"."customers" ADD COLUMN "delinquent" boolean GENERATED ALWAYS AS ((raw_data->>\'delinquent\')::boolean) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "discount";\nALTER TABLE "stripe"."customers" ADD COLUMN "discount" jsonb GENERATED ALWAYS AS (raw_data->\'discount\') STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "invoice_prefix";\nALTER TABLE "stripe"."customers" ADD COLUMN "invoice_prefix" text GENERATED ALWAYS AS ((raw_data->>\'invoice_prefix\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "invoice_settings";\nALTER TABLE "stripe"."customers" ADD COLUMN "invoice_settings" jsonb GENERATED ALWAYS AS (raw_data->\'invoice_settings\') STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."customers" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "next_invoice_sequence";\nALTER TABLE "stripe"."customers" ADD COLUMN "next_invoice_sequence" integer GENERATED ALWAYS AS ((raw_data->>\'next_invoice_sequence\')::integer) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "preferred_locales";\nALTER TABLE "stripe"."customers" ADD COLUMN "preferred_locales" jsonb GENERATED ALWAYS AS (raw_data->\'preferred_locales\') STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "tax_exempt";\nALTER TABLE "stripe"."customers" ADD COLUMN "tax_exempt" text GENERATED ALWAYS AS ((raw_data->>\'tax_exempt\')::text) STORED;\n\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "deleted";\nALTER TABLE "stripe"."customers" ADD COLUMN "deleted" boolean GENERATED ALWAYS AS ((raw_data->>\'deleted\')::boolean) STORED;\n\n-- ============================================================================\n-- DISPUTES\n-- ============================================================================\n\nALTER TABLE "stripe"."disputes" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_dispute_created_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."disputes" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."disputes" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((raw_data->>\'amount\')::bigint) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."disputes" ADD COLUMN "charge" text GENERATED ALWAYS AS ((raw_data->>\'charge\')::text) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "reason";\nALTER TABLE "stripe"."disputes" ADD COLUMN "reason" text GENERATED ALWAYS AS ((raw_data->>\'reason\')::text) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."disputes" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."disputes" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."disputes" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((raw_data->>\'updated\')::integer) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."disputes" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "evidence";\nALTER TABLE "stripe"."disputes" ADD COLUMN "evidence" jsonb GENERATED ALWAYS AS (raw_data->\'evidence\') STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."disputes" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."disputes" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "evidence_details";\nALTER TABLE "stripe"."disputes" ADD COLUMN "evidence_details" jsonb GENERATED ALWAYS AS (raw_data->\'evidence_details\') STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "balance_transactions";\nALTER TABLE "stripe"."disputes" ADD COLUMN "balance_transactions" jsonb GENERATED ALWAYS AS (raw_data->\'balance_transactions\') STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "is_charge_refundable";\nALTER TABLE "stripe"."disputes" ADD COLUMN "is_charge_refundable" boolean GENERATED ALWAYS AS ((raw_data->>\'is_charge_refundable\')::boolean) STORED;\n\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."disputes" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((raw_data->>\'payment_intent\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_dispute_created_idx ON "stripe"."disputes" USING btree (created);\n\n-- ============================================================================\n-- EARLY_FRAUD_WARNINGS\n-- ============================================================================\n\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_early_fraud_warnings_charge_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_early_fraud_warnings_payment_intent_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "actionable";\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "actionable" boolean GENERATED ALWAYS AS ((raw_data->>\'actionable\')::boolean) STORED;\n\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "charge" text GENERATED ALWAYS AS ((raw_data->>\'charge\')::text) STORED;\n\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "fraud_type";\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "fraud_type" text GENERATED ALWAYS AS ((raw_data->>\'fraud_type\')::text) STORED;\n\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((raw_data->>\'payment_intent\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_early_fraud_warnings_charge_idx ON "stripe"."early_fraud_warnings" USING btree (charge);\nCREATE INDEX stripe_early_fraud_warnings_payment_intent_idx ON "stripe"."early_fraud_warnings" USING btree (payment_intent);\n\n-- ============================================================================\n-- EVENTS\n-- ============================================================================\n\nALTER TABLE "stripe"."events" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."events" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "data";\nALTER TABLE "stripe"."events" ADD COLUMN "data" jsonb GENERATED ALWAYS AS (raw_data->\'data\') STORED;\n\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."events" ADD COLUMN "type" text GENERATED ALWAYS AS ((raw_data->>\'type\')::text) STORED;\n\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."events" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "request";\nALTER TABLE "stripe"."events" ADD COLUMN "request" text GENERATED ALWAYS AS ((raw_data->>\'request\')::text) STORED;\n\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."events" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((raw_data->>\'updated\')::integer) STORED;\n\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."events" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "api_version";\nALTER TABLE "stripe"."events" ADD COLUMN "api_version" text GENERATED ALWAYS AS ((raw_data->>\'api_version\')::text) STORED;\n\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "pending_webhooks";\nALTER TABLE "stripe"."events" ADD COLUMN "pending_webhooks" bigint GENERATED ALWAYS AS ((raw_data->>\'pending_webhooks\')::bigint) STORED;\n\n-- ============================================================================\n-- FEATURES\n-- ============================================================================\n\nALTER TABLE "stripe"."features" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop unique constraint\nALTER TABLE "stripe"."features" DROP CONSTRAINT IF EXISTS "features_lookup_key_key";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."features" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."features" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."features" ADD COLUMN "name" text GENERATED ALWAYS AS ((raw_data->>\'name\')::text) STORED;\n\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "lookup_key";\nALTER TABLE "stripe"."features" ADD COLUMN "lookup_key" text GENERATED ALWAYS AS ((raw_data->>\'lookup_key\')::text) STORED;\n\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "active";\nALTER TABLE "stripe"."features" ADD COLUMN "active" boolean GENERATED ALWAYS AS ((raw_data->>\'active\')::boolean) STORED;\n\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."features" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\n-- Recreate unique constraint\nCREATE UNIQUE INDEX features_lookup_key_key ON "stripe"."features" (lookup_key) WHERE lookup_key IS NOT NULL;\n\n-- ============================================================================\n-- INVOICES\n-- ============================================================================\n\nALTER TABLE "stripe"."invoices" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_invoices_customer_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_invoices_subscription_idx";\n\n-- Drop and recreate columns as generated (enum status converted to text)\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."invoices" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "auto_advance";\nALTER TABLE "stripe"."invoices" ADD COLUMN "auto_advance" boolean GENERATED ALWAYS AS ((raw_data->>\'auto_advance\')::boolean) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "collection_method";\nALTER TABLE "stripe"."invoices" ADD COLUMN "collection_method" text GENERATED ALWAYS AS ((raw_data->>\'collection_method\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."invoices" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."invoices" ADD COLUMN "description" text GENERATED ALWAYS AS ((raw_data->>\'description\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "hosted_invoice_url";\nALTER TABLE "stripe"."invoices" ADD COLUMN "hosted_invoice_url" text GENERATED ALWAYS AS ((raw_data->>\'hosted_invoice_url\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "lines";\nALTER TABLE "stripe"."invoices" ADD COLUMN "lines" jsonb GENERATED ALWAYS AS (raw_data->\'lines\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "period_end";\nALTER TABLE "stripe"."invoices" ADD COLUMN "period_end" integer GENERATED ALWAYS AS ((raw_data->>\'period_end\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "period_start";\nALTER TABLE "stripe"."invoices" ADD COLUMN "period_start" integer GENERATED ALWAYS AS ((raw_data->>\'period_start\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."invoices" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "total";\nALTER TABLE "stripe"."invoices" ADD COLUMN "total" bigint GENERATED ALWAYS AS ((raw_data->>\'total\')::bigint) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "account_country";\nALTER TABLE "stripe"."invoices" ADD COLUMN "account_country" text GENERATED ALWAYS AS ((raw_data->>\'account_country\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "account_name";\nALTER TABLE "stripe"."invoices" ADD COLUMN "account_name" text GENERATED ALWAYS AS ((raw_data->>\'account_name\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "account_tax_ids";\nALTER TABLE "stripe"."invoices" ADD COLUMN "account_tax_ids" jsonb GENERATED ALWAYS AS (raw_data->\'account_tax_ids\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "amount_due";\nALTER TABLE "stripe"."invoices" ADD COLUMN "amount_due" bigint GENERATED ALWAYS AS ((raw_data->>\'amount_due\')::bigint) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "amount_paid";\nALTER TABLE "stripe"."invoices" ADD COLUMN "amount_paid" bigint GENERATED ALWAYS AS ((raw_data->>\'amount_paid\')::bigint) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "amount_remaining";\nALTER TABLE "stripe"."invoices" ADD COLUMN "amount_remaining" bigint GENERATED ALWAYS AS ((raw_data->>\'amount_remaining\')::bigint) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "application_fee_amount";\nALTER TABLE "stripe"."invoices" ADD COLUMN "application_fee_amount" bigint GENERATED ALWAYS AS ((raw_data->>\'application_fee_amount\')::bigint) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "attempt_count";\nALTER TABLE "stripe"."invoices" ADD COLUMN "attempt_count" integer GENERATED ALWAYS AS ((raw_data->>\'attempt_count\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "attempted";\nALTER TABLE "stripe"."invoices" ADD COLUMN "attempted" boolean GENERATED ALWAYS AS ((raw_data->>\'attempted\')::boolean) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "billing_reason";\nALTER TABLE "stripe"."invoices" ADD COLUMN "billing_reason" text GENERATED ALWAYS AS ((raw_data->>\'billing_reason\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."invoices" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "custom_fields";\nALTER TABLE "stripe"."invoices" ADD COLUMN "custom_fields" jsonb GENERATED ALWAYS AS (raw_data->\'custom_fields\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_address";\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_address" jsonb GENERATED ALWAYS AS (raw_data->\'customer_address\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_email";\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_email" text GENERATED ALWAYS AS ((raw_data->>\'customer_email\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_name";\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_name" text GENERATED ALWAYS AS ((raw_data->>\'customer_name\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_phone";\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_phone" text GENERATED ALWAYS AS ((raw_data->>\'customer_phone\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_shipping";\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_shipping" jsonb GENERATED ALWAYS AS (raw_data->\'customer_shipping\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_tax_exempt";\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_tax_exempt" text GENERATED ALWAYS AS ((raw_data->>\'customer_tax_exempt\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_tax_ids";\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_tax_ids" jsonb GENERATED ALWAYS AS (raw_data->\'customer_tax_ids\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "default_tax_rates";\nALTER TABLE "stripe"."invoices" ADD COLUMN "default_tax_rates" jsonb GENERATED ALWAYS AS (raw_data->\'default_tax_rates\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "discount";\nALTER TABLE "stripe"."invoices" ADD COLUMN "discount" jsonb GENERATED ALWAYS AS (raw_data->\'discount\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "discounts";\nALTER TABLE "stripe"."invoices" ADD COLUMN "discounts" jsonb GENERATED ALWAYS AS (raw_data->\'discounts\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "due_date";\nALTER TABLE "stripe"."invoices" ADD COLUMN "due_date" integer GENERATED ALWAYS AS ((raw_data->>\'due_date\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "ending_balance";\nALTER TABLE "stripe"."invoices" ADD COLUMN "ending_balance" integer GENERATED ALWAYS AS ((raw_data->>\'ending_balance\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "footer";\nALTER TABLE "stripe"."invoices" ADD COLUMN "footer" text GENERATED ALWAYS AS ((raw_data->>\'footer\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "invoice_pdf";\nALTER TABLE "stripe"."invoices" ADD COLUMN "invoice_pdf" text GENERATED ALWAYS AS ((raw_data->>\'invoice_pdf\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "last_finalization_error";\nALTER TABLE "stripe"."invoices" ADD COLUMN "last_finalization_error" jsonb GENERATED ALWAYS AS (raw_data->\'last_finalization_error\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."invoices" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "next_payment_attempt";\nALTER TABLE "stripe"."invoices" ADD COLUMN "next_payment_attempt" integer GENERATED ALWAYS AS ((raw_data->>\'next_payment_attempt\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "number";\nALTER TABLE "stripe"."invoices" ADD COLUMN "number" text GENERATED ALWAYS AS ((raw_data->>\'number\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "paid";\nALTER TABLE "stripe"."invoices" ADD COLUMN "paid" boolean GENERATED ALWAYS AS ((raw_data->>\'paid\')::boolean) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "payment_settings";\nALTER TABLE "stripe"."invoices" ADD COLUMN "payment_settings" jsonb GENERATED ALWAYS AS (raw_data->\'payment_settings\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "post_payment_credit_notes_amount";\nALTER TABLE "stripe"."invoices" ADD COLUMN "post_payment_credit_notes_amount" integer GENERATED ALWAYS AS ((raw_data->>\'post_payment_credit_notes_amount\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "pre_payment_credit_notes_amount";\nALTER TABLE "stripe"."invoices" ADD COLUMN "pre_payment_credit_notes_amount" integer GENERATED ALWAYS AS ((raw_data->>\'pre_payment_credit_notes_amount\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "receipt_number";\nALTER TABLE "stripe"."invoices" ADD COLUMN "receipt_number" text GENERATED ALWAYS AS ((raw_data->>\'receipt_number\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "starting_balance";\nALTER TABLE "stripe"."invoices" ADD COLUMN "starting_balance" integer GENERATED ALWAYS AS ((raw_data->>\'starting_balance\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."invoices" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((raw_data->>\'statement_descriptor\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "status_transitions";\nALTER TABLE "stripe"."invoices" ADD COLUMN "status_transitions" jsonb GENERATED ALWAYS AS (raw_data->\'status_transitions\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "subtotal";\nALTER TABLE "stripe"."invoices" ADD COLUMN "subtotal" integer GENERATED ALWAYS AS ((raw_data->>\'subtotal\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "tax";\nALTER TABLE "stripe"."invoices" ADD COLUMN "tax" integer GENERATED ALWAYS AS ((raw_data->>\'tax\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "total_discount_amounts";\nALTER TABLE "stripe"."invoices" ADD COLUMN "total_discount_amounts" jsonb GENERATED ALWAYS AS (raw_data->\'total_discount_amounts\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "total_tax_amounts";\nALTER TABLE "stripe"."invoices" ADD COLUMN "total_tax_amounts" jsonb GENERATED ALWAYS AS (raw_data->\'total_tax_amounts\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "transfer_data";\nALTER TABLE "stripe"."invoices" ADD COLUMN "transfer_data" jsonb GENERATED ALWAYS AS (raw_data->\'transfer_data\') STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "webhooks_delivered_at";\nALTER TABLE "stripe"."invoices" ADD COLUMN "webhooks_delivered_at" integer GENERATED ALWAYS AS ((raw_data->>\'webhooks_delivered_at\')::integer) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "subscription";\nALTER TABLE "stripe"."invoices" ADD COLUMN "subscription" text GENERATED ALWAYS AS ((raw_data->>\'subscription\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."invoices" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((raw_data->>\'payment_intent\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "default_payment_method";\nALTER TABLE "stripe"."invoices" ADD COLUMN "default_payment_method" text GENERATED ALWAYS AS ((raw_data->>\'default_payment_method\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "default_source";\nALTER TABLE "stripe"."invoices" ADD COLUMN "default_source" text GENERATED ALWAYS AS ((raw_data->>\'default_source\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "on_behalf_of";\nALTER TABLE "stripe"."invoices" ADD COLUMN "on_behalf_of" text GENERATED ALWAYS AS ((raw_data->>\'on_behalf_of\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."invoices" ADD COLUMN "charge" text GENERATED ALWAYS AS ((raw_data->>\'charge\')::text) STORED;\n\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."invoices" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_invoices_customer_idx ON "stripe"."invoices" USING btree (customer);\nCREATE INDEX stripe_invoices_subscription_idx ON "stripe"."invoices" USING btree (subscription);\n\n-- ============================================================================\n-- PAYMENT_INTENTS\n-- ============================================================================\n\nALTER TABLE "stripe"."payment_intents" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_payment_intents_customer_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_payment_intents_invoice_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount" integer GENERATED ALWAYS AS ((raw_data->>\'amount\')::integer) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "amount_capturable";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount_capturable" integer GENERATED ALWAYS AS ((raw_data->>\'amount_capturable\')::integer) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "amount_details";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount_details" jsonb GENERATED ALWAYS AS (raw_data->\'amount_details\') STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "amount_received";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount_received" integer GENERATED ALWAYS AS ((raw_data->>\'amount_received\')::integer) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "application";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "application" text GENERATED ALWAYS AS ((raw_data->>\'application\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "application_fee_amount";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "application_fee_amount" integer GENERATED ALWAYS AS ((raw_data->>\'application_fee_amount\')::integer) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "automatic_payment_methods";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "automatic_payment_methods" text GENERATED ALWAYS AS ((raw_data->>\'automatic_payment_methods\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "canceled_at";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "canceled_at" integer GENERATED ALWAYS AS ((raw_data->>\'canceled_at\')::integer) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "cancellation_reason";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "cancellation_reason" text GENERATED ALWAYS AS ((raw_data->>\'cancellation_reason\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "capture_method";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "capture_method" text GENERATED ALWAYS AS ((raw_data->>\'capture_method\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "client_secret";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "client_secret" text GENERATED ALWAYS AS ((raw_data->>\'client_secret\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "confirmation_method";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "confirmation_method" text GENERATED ALWAYS AS ((raw_data->>\'confirmation_method\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "description" text GENERATED ALWAYS AS ((raw_data->>\'description\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "invoice";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "invoice" text GENERATED ALWAYS AS ((raw_data->>\'invoice\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "last_payment_error";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "last_payment_error" text GENERATED ALWAYS AS ((raw_data->>\'last_payment_error\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "next_action";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "next_action" text GENERATED ALWAYS AS ((raw_data->>\'next_action\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "on_behalf_of";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "on_behalf_of" text GENERATED ALWAYS AS ((raw_data->>\'on_behalf_of\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "payment_method";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "payment_method" text GENERATED ALWAYS AS ((raw_data->>\'payment_method\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "payment_method_options";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "payment_method_options" jsonb GENERATED ALWAYS AS (raw_data->\'payment_method_options\') STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "payment_method_types";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "payment_method_types" jsonb GENERATED ALWAYS AS (raw_data->\'payment_method_types\') STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "processing";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "processing" text GENERATED ALWAYS AS ((raw_data->>\'processing\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "receipt_email";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "receipt_email" text GENERATED ALWAYS AS ((raw_data->>\'receipt_email\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "review";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "review" text GENERATED ALWAYS AS ((raw_data->>\'review\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "setup_future_usage";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "setup_future_usage" text GENERATED ALWAYS AS ((raw_data->>\'setup_future_usage\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "shipping";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "shipping" jsonb GENERATED ALWAYS AS (raw_data->\'shipping\') STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((raw_data->>\'statement_descriptor\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "statement_descriptor_suffix";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "statement_descriptor_suffix" text GENERATED ALWAYS AS ((raw_data->>\'statement_descriptor_suffix\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "transfer_data";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "transfer_data" jsonb GENERATED ALWAYS AS (raw_data->\'transfer_data\') STORED;\n\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "transfer_group";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "transfer_group" text GENERATED ALWAYS AS ((raw_data->>\'transfer_group\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_payment_intents_customer_idx ON "stripe"."payment_intents" USING btree (customer);\nCREATE INDEX stripe_payment_intents_invoice_idx ON "stripe"."payment_intents" USING btree (invoice);\n\n-- ============================================================================\n-- PAYMENT_METHODS\n-- ============================================================================\n\nALTER TABLE "stripe"."payment_methods" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_payment_methods_customer_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "type" text GENERATED ALWAYS AS ((raw_data->>\'type\')::text) STORED;\n\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "billing_details";\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "billing_details" jsonb GENERATED ALWAYS AS (raw_data->\'billing_details\') STORED;\n\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "card";\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "card" jsonb GENERATED ALWAYS AS (raw_data->\'card\') STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_payment_methods_customer_idx ON "stripe"."payment_methods" USING btree (customer);\n\n-- ============================================================================\n-- PAYOUTS\n-- ============================================================================\n\nALTER TABLE "stripe"."payouts" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."payouts" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "date";\nALTER TABLE "stripe"."payouts" ADD COLUMN "date" text GENERATED ALWAYS AS ((raw_data->>\'date\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."payouts" ADD COLUMN "type" text GENERATED ALWAYS AS ((raw_data->>\'type\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."payouts" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((raw_data->>\'amount\')::bigint) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "method";\nALTER TABLE "stripe"."payouts" ADD COLUMN "method" text GENERATED ALWAYS AS ((raw_data->>\'method\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."payouts" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."payouts" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."payouts" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((raw_data->>\'updated\')::integer) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."payouts" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."payouts" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."payouts" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "automatic";\nALTER TABLE "stripe"."payouts" ADD COLUMN "automatic" boolean GENERATED ALWAYS AS ((raw_data->>\'automatic\')::boolean) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "recipient";\nALTER TABLE "stripe"."payouts" ADD COLUMN "recipient" text GENERATED ALWAYS AS ((raw_data->>\'recipient\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."payouts" ADD COLUMN "description" text GENERATED ALWAYS AS ((raw_data->>\'description\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "destination";\nALTER TABLE "stripe"."payouts" ADD COLUMN "destination" text GENERATED ALWAYS AS ((raw_data->>\'destination\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "source_type";\nALTER TABLE "stripe"."payouts" ADD COLUMN "source_type" text GENERATED ALWAYS AS ((raw_data->>\'source_type\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "arrival_date";\nALTER TABLE "stripe"."payouts" ADD COLUMN "arrival_date" text GENERATED ALWAYS AS ((raw_data->>\'arrival_date\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "bank_account";\nALTER TABLE "stripe"."payouts" ADD COLUMN "bank_account" jsonb GENERATED ALWAYS AS (raw_data->\'bank_account\') STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "failure_code";\nALTER TABLE "stripe"."payouts" ADD COLUMN "failure_code" text GENERATED ALWAYS AS ((raw_data->>\'failure_code\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "transfer_group";\nALTER TABLE "stripe"."payouts" ADD COLUMN "transfer_group" text GENERATED ALWAYS AS ((raw_data->>\'transfer_group\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "amount_reversed";\nALTER TABLE "stripe"."payouts" ADD COLUMN "amount_reversed" bigint GENERATED ALWAYS AS ((raw_data->>\'amount_reversed\')::bigint) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "failure_message";\nALTER TABLE "stripe"."payouts" ADD COLUMN "failure_message" text GENERATED ALWAYS AS ((raw_data->>\'failure_message\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "source_transaction";\nALTER TABLE "stripe"."payouts" ADD COLUMN "source_transaction" text GENERATED ALWAYS AS ((raw_data->>\'source_transaction\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "balance_transaction";\nALTER TABLE "stripe"."payouts" ADD COLUMN "balance_transaction" text GENERATED ALWAYS AS ((raw_data->>\'balance_transaction\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."payouts" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((raw_data->>\'statement_descriptor\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "statement_description";\nALTER TABLE "stripe"."payouts" ADD COLUMN "statement_description" text GENERATED ALWAYS AS ((raw_data->>\'statement_description\')::text) STORED;\n\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "failure_balance_transaction";\nALTER TABLE "stripe"."payouts" ADD COLUMN "failure_balance_transaction" text GENERATED ALWAYS AS ((raw_data->>\'failure_balance_transaction\')::text) STORED;\n\n-- ============================================================================\n-- PLANS\n-- ============================================================================\n\nALTER TABLE "stripe"."plans" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."plans" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."plans" ADD COLUMN "name" text GENERATED ALWAYS AS ((raw_data->>\'name\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "tiers";\nALTER TABLE "stripe"."plans" ADD COLUMN "tiers" jsonb GENERATED ALWAYS AS (raw_data->\'tiers\') STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "active";\nALTER TABLE "stripe"."plans" ADD COLUMN "active" boolean GENERATED ALWAYS AS ((raw_data->>\'active\')::boolean) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."plans" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((raw_data->>\'amount\')::bigint) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."plans" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "product";\nALTER TABLE "stripe"."plans" ADD COLUMN "product" text GENERATED ALWAYS AS ((raw_data->>\'product\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."plans" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((raw_data->>\'updated\')::integer) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."plans" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "interval";\nALTER TABLE "stripe"."plans" ADD COLUMN "interval" text GENERATED ALWAYS AS ((raw_data->>\'interval\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."plans" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."plans" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "nickname";\nALTER TABLE "stripe"."plans" ADD COLUMN "nickname" text GENERATED ALWAYS AS ((raw_data->>\'nickname\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "tiers_mode";\nALTER TABLE "stripe"."plans" ADD COLUMN "tiers_mode" text GENERATED ALWAYS AS ((raw_data->>\'tiers_mode\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "usage_type";\nALTER TABLE "stripe"."plans" ADD COLUMN "usage_type" text GENERATED ALWAYS AS ((raw_data->>\'usage_type\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "billing_scheme";\nALTER TABLE "stripe"."plans" ADD COLUMN "billing_scheme" text GENERATED ALWAYS AS ((raw_data->>\'billing_scheme\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "interval_count";\nALTER TABLE "stripe"."plans" ADD COLUMN "interval_count" bigint GENERATED ALWAYS AS ((raw_data->>\'interval_count\')::bigint) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "aggregate_usage";\nALTER TABLE "stripe"."plans" ADD COLUMN "aggregate_usage" text GENERATED ALWAYS AS ((raw_data->>\'aggregate_usage\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "transform_usage";\nALTER TABLE "stripe"."plans" ADD COLUMN "transform_usage" text GENERATED ALWAYS AS ((raw_data->>\'transform_usage\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "trial_period_days";\nALTER TABLE "stripe"."plans" ADD COLUMN "trial_period_days" bigint GENERATED ALWAYS AS ((raw_data->>\'trial_period_days\')::bigint) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."plans" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((raw_data->>\'statement_descriptor\')::text) STORED;\n\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "statement_description";\nALTER TABLE "stripe"."plans" ADD COLUMN "statement_description" text GENERATED ALWAYS AS ((raw_data->>\'statement_description\')::text) STORED;\n\n-- ============================================================================\n-- PRICES\n-- ============================================================================\n\nALTER TABLE "stripe"."prices" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated (enum types converted to text)\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."prices" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "active";\nALTER TABLE "stripe"."prices" ADD COLUMN "active" boolean GENERATED ALWAYS AS ((raw_data->>\'active\')::boolean) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."prices" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."prices" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "nickname";\nALTER TABLE "stripe"."prices" ADD COLUMN "nickname" text GENERATED ALWAYS AS ((raw_data->>\'nickname\')::text) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "recurring";\nALTER TABLE "stripe"."prices" ADD COLUMN "recurring" jsonb GENERATED ALWAYS AS (raw_data->\'recurring\') STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."prices" ADD COLUMN "type" text GENERATED ALWAYS AS ((raw_data->>\'type\')::text) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "unit_amount";\nALTER TABLE "stripe"."prices" ADD COLUMN "unit_amount" integer GENERATED ALWAYS AS ((raw_data->>\'unit_amount\')::integer) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "billing_scheme";\nALTER TABLE "stripe"."prices" ADD COLUMN "billing_scheme" text GENERATED ALWAYS AS ((raw_data->>\'billing_scheme\')::text) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."prices" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."prices" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "lookup_key";\nALTER TABLE "stripe"."prices" ADD COLUMN "lookup_key" text GENERATED ALWAYS AS ((raw_data->>\'lookup_key\')::text) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "tiers_mode";\nALTER TABLE "stripe"."prices" ADD COLUMN "tiers_mode" text GENERATED ALWAYS AS ((raw_data->>\'tiers_mode\')::text) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "transform_quantity";\nALTER TABLE "stripe"."prices" ADD COLUMN "transform_quantity" jsonb GENERATED ALWAYS AS (raw_data->\'transform_quantity\') STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "unit_amount_decimal";\nALTER TABLE "stripe"."prices" ADD COLUMN "unit_amount_decimal" text GENERATED ALWAYS AS ((raw_data->>\'unit_amount_decimal\')::text) STORED;\n\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "product";\nALTER TABLE "stripe"."prices" ADD COLUMN "product" text GENERATED ALWAYS AS ((raw_data->>\'product\')::text) STORED;\n\n-- ============================================================================\n-- PRODUCTS\n-- ============================================================================\n\nALTER TABLE "stripe"."products" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."products" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "active";\nALTER TABLE "stripe"."products" ADD COLUMN "active" boolean GENERATED ALWAYS AS ((raw_data->>\'active\')::boolean) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "default_price";\nALTER TABLE "stripe"."products" ADD COLUMN "default_price" text GENERATED ALWAYS AS ((raw_data->>\'default_price\')::text) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."products" ADD COLUMN "description" text GENERATED ALWAYS AS ((raw_data->>\'description\')::text) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."products" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."products" ADD COLUMN "name" text GENERATED ALWAYS AS ((raw_data->>\'name\')::text) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."products" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "images";\nALTER TABLE "stripe"."products" ADD COLUMN "images" jsonb GENERATED ALWAYS AS (raw_data->\'images\') STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "marketing_features";\nALTER TABLE "stripe"."products" ADD COLUMN "marketing_features" jsonb GENERATED ALWAYS AS (raw_data->\'marketing_features\') STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."products" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "package_dimensions";\nALTER TABLE "stripe"."products" ADD COLUMN "package_dimensions" jsonb GENERATED ALWAYS AS (raw_data->\'package_dimensions\') STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "shippable";\nALTER TABLE "stripe"."products" ADD COLUMN "shippable" boolean GENERATED ALWAYS AS ((raw_data->>\'shippable\')::boolean) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."products" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((raw_data->>\'statement_descriptor\')::text) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "unit_label";\nALTER TABLE "stripe"."products" ADD COLUMN "unit_label" text GENERATED ALWAYS AS ((raw_data->>\'unit_label\')::text) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."products" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((raw_data->>\'updated\')::integer) STORED;\n\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "url";\nALTER TABLE "stripe"."products" ADD COLUMN "url" text GENERATED ALWAYS AS ((raw_data->>\'url\')::text) STORED;\n\n-- ============================================================================\n-- REFUNDS\n-- ============================================================================\n\nALTER TABLE "stripe"."refunds" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_refunds_charge_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_refunds_payment_intent_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."refunds" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."refunds" ADD COLUMN "amount" integer GENERATED ALWAYS AS ((raw_data->>\'amount\')::integer) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "balance_transaction";\nALTER TABLE "stripe"."refunds" ADD COLUMN "balance_transaction" text GENERATED ALWAYS AS ((raw_data->>\'balance_transaction\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."refunds" ADD COLUMN "charge" text GENERATED ALWAYS AS ((raw_data->>\'charge\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."refunds" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."refunds" ADD COLUMN "currency" text GENERATED ALWAYS AS ((raw_data->>\'currency\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "destination_details";\nALTER TABLE "stripe"."refunds" ADD COLUMN "destination_details" jsonb GENERATED ALWAYS AS (raw_data->\'destination_details\') STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."refunds" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."refunds" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((raw_data->>\'payment_intent\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "reason";\nALTER TABLE "stripe"."refunds" ADD COLUMN "reason" text GENERATED ALWAYS AS ((raw_data->>\'reason\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "receipt_number";\nALTER TABLE "stripe"."refunds" ADD COLUMN "receipt_number" text GENERATED ALWAYS AS ((raw_data->>\'receipt_number\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "source_transfer_reversal";\nALTER TABLE "stripe"."refunds" ADD COLUMN "source_transfer_reversal" text GENERATED ALWAYS AS ((raw_data->>\'source_transfer_reversal\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."refunds" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "transfer_reversal";\nALTER TABLE "stripe"."refunds" ADD COLUMN "transfer_reversal" text GENERATED ALWAYS AS ((raw_data->>\'transfer_reversal\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_refunds_charge_idx ON "stripe"."refunds" USING btree (charge);\nCREATE INDEX stripe_refunds_payment_intent_idx ON "stripe"."refunds" USING btree (payment_intent);\n\n-- ============================================================================\n-- REVIEWS\n-- ============================================================================\n\nALTER TABLE "stripe"."reviews" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_reviews_charge_idx";\nDROP INDEX IF EXISTS "stripe"."stripe_reviews_payment_intent_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."reviews" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "billing_zip";\nALTER TABLE "stripe"."reviews" ADD COLUMN "billing_zip" text GENERATED ALWAYS AS ((raw_data->>\'billing_zip\')::text) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."reviews" ADD COLUMN "charge" text GENERATED ALWAYS AS ((raw_data->>\'charge\')::text) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."reviews" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "closed_reason";\nALTER TABLE "stripe"."reviews" ADD COLUMN "closed_reason" text GENERATED ALWAYS AS ((raw_data->>\'closed_reason\')::text) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."reviews" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "ip_address";\nALTER TABLE "stripe"."reviews" ADD COLUMN "ip_address" text GENERATED ALWAYS AS ((raw_data->>\'ip_address\')::text) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "ip_address_location";\nALTER TABLE "stripe"."reviews" ADD COLUMN "ip_address_location" jsonb GENERATED ALWAYS AS (raw_data->\'ip_address_location\') STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "open";\nALTER TABLE "stripe"."reviews" ADD COLUMN "open" boolean GENERATED ALWAYS AS ((raw_data->>\'open\')::boolean) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "opened_reason";\nALTER TABLE "stripe"."reviews" ADD COLUMN "opened_reason" text GENERATED ALWAYS AS ((raw_data->>\'opened_reason\')::text) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."reviews" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((raw_data->>\'payment_intent\')::text) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "reason";\nALTER TABLE "stripe"."reviews" ADD COLUMN "reason" text GENERATED ALWAYS AS ((raw_data->>\'reason\')::text) STORED;\n\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "session";\nALTER TABLE "stripe"."reviews" ADD COLUMN "session" text GENERATED ALWAYS AS ((raw_data->>\'session\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_reviews_charge_idx ON "stripe"."reviews" USING btree (charge);\nCREATE INDEX stripe_reviews_payment_intent_idx ON "stripe"."reviews" USING btree (payment_intent);\n\n-- ============================================================================\n-- SETUP_INTENTS\n-- ============================================================================\n\nALTER TABLE "stripe"."setup_intents" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_setup_intents_customer_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "description" text GENERATED ALWAYS AS ((raw_data->>\'description\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "payment_method";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "payment_method" text GENERATED ALWAYS AS ((raw_data->>\'payment_method\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "usage";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "usage" text GENERATED ALWAYS AS ((raw_data->>\'usage\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "cancellation_reason";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "cancellation_reason" text GENERATED ALWAYS AS ((raw_data->>\'cancellation_reason\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "latest_attempt";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "latest_attempt" text GENERATED ALWAYS AS ((raw_data->>\'latest_attempt\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "mandate";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "mandate" text GENERATED ALWAYS AS ((raw_data->>\'mandate\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "single_use_mandate";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "single_use_mandate" text GENERATED ALWAYS AS ((raw_data->>\'single_use_mandate\')::text) STORED;\n\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "on_behalf_of";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "on_behalf_of" text GENERATED ALWAYS AS ((raw_data->>\'on_behalf_of\')::text) STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_setup_intents_customer_idx ON "stripe"."setup_intents" USING btree (customer);\n\n-- ============================================================================\n-- SUBSCRIPTION_ITEMS\n-- ============================================================================\n\nALTER TABLE "stripe"."subscription_items" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "billing_thresholds";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "billing_thresholds" jsonb GENERATED ALWAYS AS (raw_data->\'billing_thresholds\') STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "deleted";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "deleted" boolean GENERATED ALWAYS AS ((raw_data->>\'deleted\')::boolean) STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "quantity";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "quantity" integer GENERATED ALWAYS AS ((raw_data->>\'quantity\')::integer) STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "price";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "price" text GENERATED ALWAYS AS ((raw_data->>\'price\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "subscription";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "subscription" text GENERATED ALWAYS AS ((raw_data->>\'subscription\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "tax_rates";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "tax_rates" jsonb GENERATED ALWAYS AS (raw_data->\'tax_rates\') STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "current_period_end";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "current_period_end" integer GENERATED ALWAYS AS ((raw_data->>\'current_period_end\')::integer) STORED;\n\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "current_period_start";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "current_period_start" integer GENERATED ALWAYS AS ((raw_data->>\'current_period_start\')::integer) STORED;\n\n-- ============================================================================\n-- SUBSCRIPTION_SCHEDULES\n-- ============================================================================\n\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated (enum status converted to text)\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "application";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "application" text GENERATED ALWAYS AS ((raw_data->>\'application\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "canceled_at";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "canceled_at" integer GENERATED ALWAYS AS ((raw_data->>\'canceled_at\')::integer) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "completed_at";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "completed_at" integer GENERATED ALWAYS AS ((raw_data->>\'completed_at\')::integer) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "current_phase";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "current_phase" jsonb GENERATED ALWAYS AS (raw_data->\'current_phase\') STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "default_settings";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "default_settings" jsonb GENERATED ALWAYS AS (raw_data->\'default_settings\') STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "end_behavior";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "end_behavior" text GENERATED ALWAYS AS ((raw_data->>\'end_behavior\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "phases";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "phases" jsonb GENERATED ALWAYS AS (raw_data->\'phases\') STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "released_at";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "released_at" integer GENERATED ALWAYS AS ((raw_data->>\'released_at\')::integer) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "released_subscription";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "released_subscription" text GENERATED ALWAYS AS ((raw_data->>\'released_subscription\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "subscription";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "subscription" text GENERATED ALWAYS AS ((raw_data->>\'subscription\')::text) STORED;\n\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "test_clock";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "test_clock" text GENERATED ALWAYS AS ((raw_data->>\'test_clock\')::text) STORED;\n\n-- ============================================================================\n-- SUBSCRIPTIONS\n-- ============================================================================\n\nALTER TABLE "stripe"."subscriptions" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop and recreate columns as generated (enum status converted to text)\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "cancel_at_period_end";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "cancel_at_period_end" boolean GENERATED ALWAYS AS ((raw_data->>\'cancel_at_period_end\')::boolean) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "current_period_end";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "current_period_end" integer GENERATED ALWAYS AS ((raw_data->>\'current_period_end\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "current_period_start";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "current_period_start" integer GENERATED ALWAYS AS ((raw_data->>\'current_period_start\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "default_payment_method";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "default_payment_method" text GENERATED ALWAYS AS ((raw_data->>\'default_payment_method\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "items";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "items" jsonb GENERATED ALWAYS AS (raw_data->\'items\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (raw_data->\'metadata\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "pending_setup_intent";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "pending_setup_intent" text GENERATED ALWAYS AS ((raw_data->>\'pending_setup_intent\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "pending_update";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "pending_update" jsonb GENERATED ALWAYS AS (raw_data->\'pending_update\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "status" text GENERATED ALWAYS AS ((raw_data->>\'status\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "application_fee_percent";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "application_fee_percent" double precision GENERATED ALWAYS AS ((raw_data->>\'application_fee_percent\')::double precision) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "billing_cycle_anchor";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "billing_cycle_anchor" integer GENERATED ALWAYS AS ((raw_data->>\'billing_cycle_anchor\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "billing_thresholds";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "billing_thresholds" jsonb GENERATED ALWAYS AS (raw_data->\'billing_thresholds\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "cancel_at";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "cancel_at" integer GENERATED ALWAYS AS ((raw_data->>\'cancel_at\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "canceled_at";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "canceled_at" integer GENERATED ALWAYS AS ((raw_data->>\'canceled_at\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "collection_method";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "collection_method" text GENERATED ALWAYS AS ((raw_data->>\'collection_method\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "days_until_due";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "days_until_due" integer GENERATED ALWAYS AS ((raw_data->>\'days_until_due\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "default_source";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "default_source" text GENERATED ALWAYS AS ((raw_data->>\'default_source\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "default_tax_rates";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "default_tax_rates" jsonb GENERATED ALWAYS AS (raw_data->\'default_tax_rates\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "discount";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "discount" jsonb GENERATED ALWAYS AS (raw_data->\'discount\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "ended_at";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "ended_at" integer GENERATED ALWAYS AS ((raw_data->>\'ended_at\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "next_pending_invoice_item_invoice";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "next_pending_invoice_item_invoice" integer GENERATED ALWAYS AS ((raw_data->>\'next_pending_invoice_item_invoice\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "pause_collection";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "pause_collection" jsonb GENERATED ALWAYS AS (raw_data->\'pause_collection\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "pending_invoice_item_interval";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "pending_invoice_item_interval" jsonb GENERATED ALWAYS AS (raw_data->\'pending_invoice_item_interval\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "start_date";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "start_date" integer GENERATED ALWAYS AS ((raw_data->>\'start_date\')::integer) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "transfer_data";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "transfer_data" jsonb GENERATED ALWAYS AS (raw_data->\'transfer_data\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "trial_end";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "trial_end" jsonb GENERATED ALWAYS AS (raw_data->\'trial_end\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "trial_start";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "trial_start" jsonb GENERATED ALWAYS AS (raw_data->\'trial_start\') STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "schedule";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "schedule" text GENERATED ALWAYS AS ((raw_data->>\'schedule\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "latest_invoice";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "latest_invoice" text GENERATED ALWAYS AS ((raw_data->>\'latest_invoice\')::text) STORED;\n\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "plan";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "plan" text GENERATED ALWAYS AS ((raw_data->>\'plan\')::text) STORED;\n\n-- ============================================================================\n-- TAX_IDS\n-- ============================================================================\n\nALTER TABLE "stripe"."tax_ids" ADD COLUMN IF NOT EXISTS "raw_data" jsonb;\n\n-- Drop indexes\nDROP INDEX IF EXISTS "stripe"."stripe_tax_ids_customer_idx";\n\n-- Drop and recreate columns as generated\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "object" text GENERATED ALWAYS AS ((raw_data->>\'object\')::text) STORED;\n\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "country";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "country" text GENERATED ALWAYS AS ((raw_data->>\'country\')::text) STORED;\n\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "customer" text GENERATED ALWAYS AS ((raw_data->>\'customer\')::text) STORED;\n\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "type" text GENERATED ALWAYS AS ((raw_data->>\'type\')::text) STORED;\n\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "value";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "value" text GENERATED ALWAYS AS ((raw_data->>\'value\')::text) STORED;\n\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "created" integer GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED;\n\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((raw_data->>\'livemode\')::boolean) STORED;\n\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "owner";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "owner" jsonb GENERATED ALWAYS AS (raw_data->\'owner\') STORED;\n\n-- Recreate indexes\nCREATE INDEX stripe_tax_ids_customer_idx ON "stripe"."tax_ids" USING btree (customer);\n\n',
  },
  {
    name: '0043_add_account_id.sql',
    sql: '-- Add _account_id column to all tables to track which Stripe account each record belongs to\n-- Column is nullable for backward compatibility with existing data\n\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."charges" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."credit_notes" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."customers" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."disputes" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."features" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."invoices" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."_managed_webhooks" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."payment_intents" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."payment_methods" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."plans" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."prices" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."products" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."refunds" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."reviews" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."setup_intents" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."subscription_items" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."subscriptions" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\nALTER TABLE "stripe"."tax_ids" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;\n\n',
  },
  {
    name: '0044_make_account_id_required.sql',
    sql: '-- Make _account_id required by:\n-- 1. Deleting all rows where _account_id IS NULL\n-- 2. Setting _account_id to NOT NULL\n\n-- Delete rows with null _account_id\nDELETE FROM "stripe"."active_entitlements" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."charges" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."checkout_session_line_items" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."checkout_sessions" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."credit_notes" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."customers" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."disputes" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."early_fraud_warnings" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."features" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."invoices" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."_managed_webhooks" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."payment_intents" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."payment_methods" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."plans" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."prices" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."products" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."refunds" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."reviews" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."setup_intents" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."subscription_items" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."subscription_schedules" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."subscriptions" WHERE "_account_id" IS NULL;\nDELETE FROM "stripe"."tax_ids" WHERE "_account_id" IS NULL;\n\n-- Make _account_id NOT NULL\nALTER TABLE "stripe"."active_entitlements" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."charges" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."checkout_session_line_items" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."checkout_sessions" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."credit_notes" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."customers" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."disputes" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."early_fraud_warnings" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."features" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."invoices" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."_managed_webhooks" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."payment_intents" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."payment_methods" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."plans" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."prices" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."products" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."refunds" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."reviews" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."setup_intents" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."subscription_items" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."subscription_schedules" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."subscriptions" ALTER COLUMN "_account_id" SET NOT NULL;\nALTER TABLE "stripe"."tax_ids" ALTER COLUMN "_account_id" SET NOT NULL;\n\n',
  },
  {
    name: '0045_sync_status.sql',
    sql: "-- Create _sync_status metadata table for tracking incremental sync cursors\n-- This table tracks the state and progress of each resource's synchronization\n\nCREATE TABLE IF NOT EXISTS \"stripe\".\"_sync_status\" (\n  id serial PRIMARY KEY,\n  resource text UNIQUE NOT NULL,\n  status text CHECK (status IN ('idle', 'running', 'complete', 'error')) DEFAULT 'idle',\n  last_synced_at timestamptz DEFAULT now(),\n  last_incremental_cursor timestamptz,\n  error_message text,\n  updated_at timestamptz DEFAULT now()\n);\n\n-- Use existing set_updated_at() function created in migration 0012\nCREATE TRIGGER handle_updated_at\n  BEFORE UPDATE ON \"stripe\".\"_sync_status\"\n  FOR EACH ROW\n  EXECUTE PROCEDURE set_updated_at();\n",
  },
  {
    name: '0046_sync_status_per_account.sql',
    sql: '-- Add _account_id to _sync_status table to track sync cursors per account\n-- This enables proper cursor isolation when syncing multiple Stripe accounts\n--\n-- Breaking change: All existing cursor data will be deleted (clean slate)\n-- Next sync will perform a full backfill for each account\n\n-- Step 1: Delete all existing cursor data\nDELETE FROM "stripe"."_sync_status";\n\n-- Step 2: Add _account_id column\nALTER TABLE "stripe"."_sync_status" ADD COLUMN "_account_id" TEXT NOT NULL;\n\n-- Step 3: Drop existing unique constraint on resource\nALTER TABLE "stripe"."_sync_status" DROP CONSTRAINT IF EXISTS _sync_status_resource_key;\n\n-- Step 4: Add new composite unique constraint on (resource, _account_id)\nALTER TABLE "stripe"."_sync_status"\n  ADD CONSTRAINT _sync_status_resource_account_key\n  UNIQUE (resource, "_account_id");\n\n-- Step 5: Add index for efficient lookups\nCREATE INDEX IF NOT EXISTS idx_sync_status_resource_account\n  ON "stripe"."_sync_status" (resource, "_account_id");\n\n-- Step 6: Create accounts table to track Stripe accounts (JSONB with generated columns)\nCREATE TABLE IF NOT EXISTS "stripe"."accounts" (\n  id TEXT PRIMARY KEY,\n  raw_data JSONB NOT NULL,\n  first_synced_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  last_synced_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  -- Generated columns extracted from raw_data\n  business_name TEXT GENERATED ALWAYS AS ((raw_data->\'business_profile\'->>\'name\')::text) STORED,\n  email TEXT GENERATED ALWAYS AS ((raw_data->>\'email\')::text) STORED,\n  type TEXT GENERATED ALWAYS AS ((raw_data->>\'type\')::text) STORED,\n  charges_enabled BOOLEAN GENERATED ALWAYS AS ((raw_data->>\'charges_enabled\')::boolean) STORED,\n  payouts_enabled BOOLEAN GENERATED ALWAYS AS ((raw_data->>\'payouts_enabled\')::boolean) STORED,\n  details_submitted BOOLEAN GENERATED ALWAYS AS ((raw_data->>\'details_submitted\')::boolean) STORED,\n  country TEXT GENERATED ALWAYS AS ((raw_data->>\'country\')::text) STORED,\n  default_currency TEXT GENERATED ALWAYS AS ((raw_data->>\'default_currency\')::text) STORED,\n  created INTEGER GENERATED ALWAYS AS ((raw_data->>\'created\')::integer) STORED\n);\n\n-- Step 7: Add index for account name lookups\nCREATE INDEX IF NOT EXISTS idx_accounts_business_name\n  ON "stripe"."accounts" (business_name);\n\n-- Step 8: Add updated_at trigger for accounts\nCREATE TRIGGER handle_updated_at\n  BEFORE UPDATE ON "stripe"."accounts"\n  FOR EACH ROW\n  EXECUTE PROCEDURE set_updated_at();\n\n-- Step 9: Backfill accounts from existing data tables\nINSERT INTO "stripe"."accounts" (id, raw_data, first_synced_at, last_synced_at)\nSELECT DISTINCT\n  "_account_id" as id,\n  jsonb_build_object(\'id\', "_account_id", \'type\', \'unknown\') as raw_data,\n  now() as first_synced_at,\n  now() as last_synced_at\nFROM "stripe"."products"\nWHERE "_account_id" IS NOT NULL\nON CONFLICT (id) DO NOTHING;\n\n-- Step 10: Add foreign key constraints from data tables to accounts\nALTER TABLE "stripe"."active_entitlements" ADD CONSTRAINT fk_active_entitlements_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."charges" ADD CONSTRAINT fk_charges_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."checkout_session_line_items" ADD CONSTRAINT fk_checkout_session_line_items_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."checkout_sessions" ADD CONSTRAINT fk_checkout_sessions_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."credit_notes" ADD CONSTRAINT fk_credit_notes_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."customers" ADD CONSTRAINT fk_customers_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."disputes" ADD CONSTRAINT fk_disputes_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."early_fraud_warnings" ADD CONSTRAINT fk_early_fraud_warnings_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."features" ADD CONSTRAINT fk_features_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."invoices" ADD CONSTRAINT fk_invoices_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."_managed_webhooks" ADD CONSTRAINT fk_managed_webhooks_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."payment_intents" ADD CONSTRAINT fk_payment_intents_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."payment_methods" ADD CONSTRAINT fk_payment_methods_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."plans" ADD CONSTRAINT fk_plans_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."prices" ADD CONSTRAINT fk_prices_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."products" ADD CONSTRAINT fk_products_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."refunds" ADD CONSTRAINT fk_refunds_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."reviews" ADD CONSTRAINT fk_reviews_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."setup_intents" ADD CONSTRAINT fk_setup_intents_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."subscription_items" ADD CONSTRAINT fk_subscription_items_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."subscription_schedules" ADD CONSTRAINT fk_subscription_schedules_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."subscriptions" ADD CONSTRAINT fk_subscriptions_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."tax_ids" ADD CONSTRAINT fk_tax_ids_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\n\n-- Step 11: Add foreign key from _sync_status to accounts\nALTER TABLE "stripe"."_sync_status" ADD CONSTRAINT fk_sync_status_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\n',
  },
  {
    name: '0047_api_key_hashes.sql',
    sql: '-- Add api_key_hashes array column to accounts table\n-- This stores SHA-256 hashes of Stripe API keys for fast account lookups\n-- Enables lookup of account ID by API key hash without making Stripe API calls\n-- Supports multiple API keys per account (test/live keys, rotated keys, etc.)\n\n-- Step 1: Add api_key_hashes column as TEXT array\nALTER TABLE "stripe"."accounts" ADD COLUMN "api_key_hashes" TEXT[] DEFAULT \'{}\';\n\n-- Step 2: Create GIN index for fast array containment lookups\n-- This enables efficient queries like: WHERE \'hash_value\' = ANY(api_key_hashes)\nCREATE INDEX IF NOT EXISTS idx_accounts_api_key_hashes\n  ON "stripe"."accounts" USING GIN (api_key_hashes);\n',
  },
  {
    name: '0048_rename_reserved_columns.sql',
    sql: '-- Rename all reserved column names to use underscore prefix\n-- This clearly distinguishes system-managed columns from user-accessible data\n--\n-- Changes:\n-- - id -> _id (primary key for all tables)\n-- - raw_data -> _raw_data (JSONB source of truth)\n-- - last_synced_at -> _last_synced_at (sync timestamp)\n-- - updated_at -> _updated_at (last update timestamp)\n-- - _account_id remains unchanged (already has underscore prefix)\n\n-- ============================================================================\n-- STEP 1: RENAME BASE COLUMNS FOR ALL TABLES\n-- ============================================================================\n\n-- This renames id, raw_data, last_synced_at, and updated_at for all tables\n-- PostgreSQL automatically updates primary keys, foreign keys, and indexes\n\n-- active_entitlements\nALTER TABLE "stripe"."active_entitlements" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."active_entitlements" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."active_entitlements" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."active_entitlements" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- charges\nALTER TABLE "stripe"."charges" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."charges" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."charges" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."charges" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- checkout_session_line_items\nALTER TABLE "stripe"."checkout_session_line_items" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."checkout_session_line_items" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."checkout_session_line_items" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."checkout_session_line_items" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- checkout_sessions\nALTER TABLE "stripe"."checkout_sessions" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."checkout_sessions" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."checkout_sessions" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."checkout_sessions" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- credit_notes\nALTER TABLE "stripe"."credit_notes" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."credit_notes" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."credit_notes" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\n\n-- coupons\nALTER TABLE "stripe"."coupons" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."coupons" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."coupons" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."coupons" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- customers\nALTER TABLE "stripe"."customers" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."customers" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."customers" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."customers" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- disputes\nALTER TABLE "stripe"."disputes" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."disputes" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."disputes" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."disputes" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- early_fraud_warnings\nALTER TABLE "stripe"."early_fraud_warnings" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."early_fraud_warnings" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."early_fraud_warnings" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."early_fraud_warnings" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- events\nALTER TABLE "stripe"."events" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."events" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."events" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."events" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- features\nALTER TABLE "stripe"."features" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."features" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."features" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."features" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- invoices\nALTER TABLE "stripe"."invoices" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."invoices" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."invoices" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."invoices" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- _managed_webhooks\nALTER TABLE "stripe"."_managed_webhooks" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."_managed_webhooks" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."_managed_webhooks" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- payment_intents\nALTER TABLE "stripe"."payment_intents" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."payment_intents" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."payment_intents" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\n\n-- payment_methods\nALTER TABLE "stripe"."payment_methods" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."payment_methods" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."payment_methods" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\n\n-- payouts\nALTER TABLE "stripe"."payouts" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."payouts" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."payouts" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."payouts" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- plans\nALTER TABLE "stripe"."plans" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."plans" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."plans" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."plans" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- prices\nALTER TABLE "stripe"."prices" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."prices" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."prices" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."prices" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- products\nALTER TABLE "stripe"."products" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."products" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."products" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."products" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- refunds\nALTER TABLE "stripe"."refunds" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."refunds" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."refunds" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."refunds" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- reviews\nALTER TABLE "stripe"."reviews" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."reviews" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."reviews" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."reviews" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- setup_intents\nALTER TABLE "stripe"."setup_intents" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."setup_intents" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."setup_intents" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\n\n-- subscription_items\nALTER TABLE "stripe"."subscription_items" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."subscription_items" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."subscription_items" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\n\n-- subscription_schedules\nALTER TABLE "stripe"."subscription_schedules" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."subscription_schedules" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."subscription_schedules" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\n\n-- subscriptions\nALTER TABLE "stripe"."subscriptions" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."subscriptions" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."subscriptions" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."subscriptions" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- tax_ids\nALTER TABLE "stripe"."tax_ids" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."tax_ids" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."tax_ids" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\n\n-- Metadata Tables\n\n-- _sync_status\nALTER TABLE "stripe"."_sync_status" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."_sync_status" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."_sync_status" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- accounts\nALTER TABLE "stripe"."accounts" RENAME COLUMN "id" TO "_id";\nALTER TABLE "stripe"."accounts" RENAME COLUMN "raw_data" TO "_raw_data";\nALTER TABLE "stripe"."accounts" RENAME COLUMN "last_synced_at" TO "_last_synced_at";\nALTER TABLE "stripe"."accounts" RENAME COLUMN "updated_at" TO "_updated_at";\n\n-- ============================================================================\n-- STEP 1.5: UPDATE TRIGGER FUNCTION TO USE NEW COLUMN NAME\n-- ============================================================================\n\n-- Now that all columns are renamed, update the trigger function to reference _updated_at\nCREATE OR REPLACE FUNCTION set_updated_at() RETURNS trigger\n    LANGUAGE plpgsql\nAS $$\nbegin\n  new._updated_at = now();\n  return NEW;\nend;\n$$;\n\n-- ============================================================================\n-- STEP 2: RECREATE GENERATED COLUMNS TO REFERENCE _raw_data\n-- ============================================================================\n\n-- All generated columns must be dropped and recreated to reference the new\n-- _raw_data column name instead of raw_data\n\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "feature";\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "lookup_key";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "paid";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "order";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "review";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "source";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "dispute";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "invoice";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "outcome";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "refunds";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "captured";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "refunded";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "shipping";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "application";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "destination";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "failure_code";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "on_behalf_of";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "fraud_details";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "receipt_email";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "receipt_number";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "transfer_group";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "amount_refunded";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "application_fee";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "failure_message";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "source_transfer";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "balance_transaction";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "payment_method_details";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "amount_discount";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "amount_subtotal";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "amount_tax";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "amount_total";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "price";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "quantity";\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "checkout_session";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "adaptive_pricing";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "after_expiration";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "allow_promotion_codes";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "amount_subtotal";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "amount_total";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "automatic_tax";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "billing_address_collection";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "cancel_url";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "client_reference_id";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "client_secret";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "collected_information";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "consent";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "consent_collection";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "currency_conversion";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "custom_fields";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "custom_text";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "customer_creation";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "customer_details";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "customer_email";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "discounts";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "expires_at";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "invoice";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "invoice_creation";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "locale";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "mode";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "optional_items";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_link";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_method_collection";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_method_configuration_details";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_method_options";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_method_types";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "payment_status";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "permissions";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "phone_number_collection";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "presentment_details";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "recovered_from";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "redirect_on_completion";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "return_url";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "saved_payment_method_options";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "setup_intent";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "shipping_address_collection";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "shipping_cost";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "shipping_details";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "shipping_options";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "submit_type";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "subscription";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "success_url";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "tax_id_collection";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "total_details";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "ui_mode";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "url";\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "wallet_options";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "valid";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "duration";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "redeem_by";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "amount_off";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "percent_off";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "times_redeemed";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "max_redemptions";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "duration_in_months";\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "percent_off_precise";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "amount_shipping";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "customer_balance_transaction";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "discount_amount";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "discount_amounts";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "invoice";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "lines";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "memo";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "number";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "out_of_band_amount";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "pdf";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "reason";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "refund";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "shipping_cost";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "subtotal";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "subtotal_excluding_tax";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "tax_amounts";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "total";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "total_excluding_tax";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "voided_at";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "address";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "email";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "phone";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "shipping";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "balance";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "default_source";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "delinquent";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "discount";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "invoice_prefix";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "invoice_settings";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "next_invoice_sequence";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "preferred_locales";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "tax_exempt";\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "deleted";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "reason";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "evidence";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "evidence_details";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "balance_transactions";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "is_charge_refundable";\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "actionable";\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "fraud_type";\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "data";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "request";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "api_version";\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "pending_webhooks";\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "lookup_key";\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "active";\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "auto_advance";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "collection_method";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "hosted_invoice_url";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "lines";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "period_end";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "period_start";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "total";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "account_country";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "account_name";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "account_tax_ids";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "amount_due";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "amount_paid";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "amount_remaining";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "application_fee_amount";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "attempt_count";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "attempted";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "billing_reason";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "custom_fields";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_address";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_email";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_name";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_phone";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_shipping";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_tax_exempt";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer_tax_ids";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "default_tax_rates";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "discount";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "discounts";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "due_date";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "ending_balance";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "footer";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "invoice_pdf";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "last_finalization_error";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "next_payment_attempt";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "number";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "paid";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "payment_settings";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "post_payment_credit_notes_amount";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "pre_payment_credit_notes_amount";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "receipt_number";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "starting_balance";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "status_transitions";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "subtotal";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "tax";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "total_discount_amounts";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "total_tax_amounts";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "transfer_data";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "webhooks_delivered_at";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "subscription";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "default_payment_method";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "default_source";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "on_behalf_of";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "amount_capturable";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "amount_details";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "amount_received";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "application";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "application_fee_amount";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "automatic_payment_methods";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "canceled_at";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "cancellation_reason";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "capture_method";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "client_secret";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "confirmation_method";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "invoice";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "last_payment_error";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "next_action";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "on_behalf_of";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "payment_method";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "payment_method_options";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "payment_method_types";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "processing";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "receipt_email";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "review";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "setup_future_usage";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "shipping";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "statement_descriptor_suffix";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "transfer_data";\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "transfer_group";\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "billing_details";\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "card";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "date";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "method";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "automatic";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "recipient";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "destination";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "source_type";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "arrival_date";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "bank_account";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "failure_code";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "transfer_group";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "amount_reversed";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "failure_message";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "source_transaction";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "balance_transaction";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "statement_description";\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "failure_balance_transaction";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "tiers";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "active";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "product";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "interval";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "nickname";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "tiers_mode";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "usage_type";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "billing_scheme";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "interval_count";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "aggregate_usage";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "transform_usage";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "trial_period_days";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "statement_description";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "active";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "nickname";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "recurring";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "unit_amount";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "billing_scheme";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "lookup_key";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "tiers_mode";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "transform_quantity";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "unit_amount_decimal";\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "product";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "active";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "default_price";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "name";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "images";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "marketing_features";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "package_dimensions";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "shippable";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "statement_descriptor";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "unit_label";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "updated";\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "url";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "amount";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "balance_transaction";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "currency";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "destination_details";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "reason";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "receipt_number";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "source_transfer_reversal";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "transfer_reversal";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "billing_zip";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "charge";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "closed_reason";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "ip_address";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "ip_address_location";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "open";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "opened_reason";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "payment_intent";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "reason";\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "session";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "description";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "payment_method";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "usage";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "cancellation_reason";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "latest_attempt";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "mandate";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "single_use_mandate";\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "on_behalf_of";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "billing_thresholds";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "deleted";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "quantity";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "price";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "subscription";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "tax_rates";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "current_period_end";\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "current_period_start";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "application";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "canceled_at";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "completed_at";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "current_phase";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "default_settings";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "end_behavior";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "phases";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "released_at";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "released_subscription";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "subscription";\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "test_clock";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "cancel_at_period_end";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "current_period_end";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "current_period_start";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "default_payment_method";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "items";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "metadata";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "pending_setup_intent";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "pending_update";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "status";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "application_fee_percent";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "billing_cycle_anchor";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "billing_thresholds";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "cancel_at";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "canceled_at";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "collection_method";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "days_until_due";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "default_source";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "default_tax_rates";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "discount";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "ended_at";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "next_pending_invoice_item_invoice";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "pause_collection";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "pending_invoice_item_interval";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "start_date";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "transfer_data";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "trial_end";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "trial_start";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "schedule";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "latest_invoice";\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "plan";\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "object";\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "country";\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "customer";\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "type";\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "value";\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "created";\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "livemode";\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "owner";\n\n-- Add generated columns back with _raw_data references\n\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "feature" text GENERATED ALWAYS AS ((_raw_data->>\'feature\')::text) STORED;\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "lookup_key" text GENERATED ALWAYS AS ((_raw_data->>\'lookup_key\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "paid" boolean GENERATED ALWAYS AS ((_raw_data->>\'paid\')::boolean) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "order" text GENERATED ALWAYS AS ((_raw_data->>\'order\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount\')::bigint) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "review" text GENERATED ALWAYS AS ((_raw_data->>\'review\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "source" jsonb GENERATED ALWAYS AS (_raw_data->\'source\') STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "dispute" text GENERATED ALWAYS AS ((_raw_data->>\'dispute\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "invoice" text GENERATED ALWAYS AS ((_raw_data->>\'invoice\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "outcome" jsonb GENERATED ALWAYS AS (_raw_data->\'outcome\') STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "refunds" jsonb GENERATED ALWAYS AS (_raw_data->\'refunds\') STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((_raw_data->>\'updated\')::integer) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "captured" boolean GENERATED ALWAYS AS ((_raw_data->>\'captured\')::boolean) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "refunded" boolean GENERATED ALWAYS AS ((_raw_data->>\'refunded\')::boolean) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "shipping" jsonb GENERATED ALWAYS AS (_raw_data->\'shipping\') STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "application" text GENERATED ALWAYS AS ((_raw_data->>\'application\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "description" text GENERATED ALWAYS AS ((_raw_data->>\'description\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "destination" text GENERATED ALWAYS AS ((_raw_data->>\'destination\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "failure_code" text GENERATED ALWAYS AS ((_raw_data->>\'failure_code\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "on_behalf_of" text GENERATED ALWAYS AS ((_raw_data->>\'on_behalf_of\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "fraud_details" jsonb GENERATED ALWAYS AS (_raw_data->\'fraud_details\') STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "receipt_email" text GENERATED ALWAYS AS ((_raw_data->>\'receipt_email\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((_raw_data->>\'payment_intent\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "receipt_number" text GENERATED ALWAYS AS ((_raw_data->>\'receipt_number\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "transfer_group" text GENERATED ALWAYS AS ((_raw_data->>\'transfer_group\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "amount_refunded" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_refunded\')::bigint) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "application_fee" text GENERATED ALWAYS AS ((_raw_data->>\'application_fee\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "failure_message" text GENERATED ALWAYS AS ((_raw_data->>\'failure_message\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "source_transfer" text GENERATED ALWAYS AS ((_raw_data->>\'source_transfer\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "balance_transaction" text GENERATED ALWAYS AS ((_raw_data->>\'balance_transaction\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((_raw_data->>\'statement_descriptor\')::text) STORED;\nALTER TABLE "stripe"."charges" ADD COLUMN "payment_method_details" jsonb GENERATED ALWAYS AS (_raw_data->\'payment_method_details\') STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_discount" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_discount\')::integer) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_subtotal" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_subtotal\')::integer) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_tax" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_tax\')::integer) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_total" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_total\')::integer) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "description" text GENERATED ALWAYS AS ((_raw_data->>\'description\')::text) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "price" text GENERATED ALWAYS AS ((_raw_data->>\'price\')::text) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "quantity" integer GENERATED ALWAYS AS ((_raw_data->>\'quantity\')::integer) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "checkout_session" text GENERATED ALWAYS AS ((_raw_data->>\'checkout_session\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "adaptive_pricing" jsonb GENERATED ALWAYS AS (_raw_data->\'adaptive_pricing\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "after_expiration" jsonb GENERATED ALWAYS AS (_raw_data->\'after_expiration\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "allow_promotion_codes" boolean GENERATED ALWAYS AS ((_raw_data->>\'allow_promotion_codes\')::boolean) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "amount_subtotal" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_subtotal\')::integer) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "amount_total" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_total\')::integer) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "automatic_tax" jsonb GENERATED ALWAYS AS (_raw_data->\'automatic_tax\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "billing_address_collection" text GENERATED ALWAYS AS ((_raw_data->>\'billing_address_collection\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "cancel_url" text GENERATED ALWAYS AS ((_raw_data->>\'cancel_url\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "client_reference_id" text GENERATED ALWAYS AS ((_raw_data->>\'client_reference_id\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "client_secret" text GENERATED ALWAYS AS ((_raw_data->>\'client_secret\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "collected_information" jsonb GENERATED ALWAYS AS (_raw_data->\'collected_information\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "consent" jsonb GENERATED ALWAYS AS (_raw_data->\'consent\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "consent_collection" jsonb GENERATED ALWAYS AS (_raw_data->\'consent_collection\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "currency_conversion" jsonb GENERATED ALWAYS AS (_raw_data->\'currency_conversion\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "custom_fields" jsonb GENERATED ALWAYS AS (_raw_data->\'custom_fields\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "custom_text" jsonb GENERATED ALWAYS AS (_raw_data->\'custom_text\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "customer_creation" text GENERATED ALWAYS AS ((_raw_data->>\'customer_creation\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "customer_details" jsonb GENERATED ALWAYS AS (_raw_data->\'customer_details\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "customer_email" text GENERATED ALWAYS AS ((_raw_data->>\'customer_email\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "discounts" jsonb GENERATED ALWAYS AS (_raw_data->\'discounts\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "expires_at" integer GENERATED ALWAYS AS ((_raw_data->>\'expires_at\')::integer) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "invoice" text GENERATED ALWAYS AS ((_raw_data->>\'invoice\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "invoice_creation" jsonb GENERATED ALWAYS AS (_raw_data->\'invoice_creation\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "locale" text GENERATED ALWAYS AS ((_raw_data->>\'locale\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "mode" text GENERATED ALWAYS AS ((_raw_data->>\'mode\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "optional_items" jsonb GENERATED ALWAYS AS (_raw_data->\'optional_items\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((_raw_data->>\'payment_intent\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_link" text GENERATED ALWAYS AS ((_raw_data->>\'payment_link\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_method_collection" text GENERATED ALWAYS AS ((_raw_data->>\'payment_method_collection\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_method_configuration_details" jsonb GENERATED ALWAYS AS (_raw_data->\'payment_method_configuration_details\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_method_options" jsonb GENERATED ALWAYS AS (_raw_data->\'payment_method_options\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_method_types" jsonb GENERATED ALWAYS AS (_raw_data->\'payment_method_types\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "payment_status" text GENERATED ALWAYS AS ((_raw_data->>\'payment_status\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "permissions" jsonb GENERATED ALWAYS AS (_raw_data->\'permissions\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "phone_number_collection" jsonb GENERATED ALWAYS AS (_raw_data->\'phone_number_collection\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "presentment_details" jsonb GENERATED ALWAYS AS (_raw_data->\'presentment_details\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "recovered_from" text GENERATED ALWAYS AS ((_raw_data->>\'recovered_from\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "redirect_on_completion" text GENERATED ALWAYS AS ((_raw_data->>\'redirect_on_completion\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "return_url" text GENERATED ALWAYS AS ((_raw_data->>\'return_url\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "saved_payment_method_options" jsonb GENERATED ALWAYS AS (_raw_data->\'saved_payment_method_options\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "setup_intent" text GENERATED ALWAYS AS ((_raw_data->>\'setup_intent\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "shipping_address_collection" jsonb GENERATED ALWAYS AS (_raw_data->\'shipping_address_collection\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "shipping_cost" jsonb GENERATED ALWAYS AS (_raw_data->\'shipping_cost\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "shipping_details" jsonb GENERATED ALWAYS AS (_raw_data->\'shipping_details\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "shipping_options" jsonb GENERATED ALWAYS AS (_raw_data->\'shipping_options\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "submit_type" text GENERATED ALWAYS AS ((_raw_data->>\'submit_type\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "subscription" text GENERATED ALWAYS AS ((_raw_data->>\'subscription\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "success_url" text GENERATED ALWAYS AS ((_raw_data->>\'success_url\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "tax_id_collection" jsonb GENERATED ALWAYS AS (_raw_data->\'tax_id_collection\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "total_details" jsonb GENERATED ALWAYS AS (_raw_data->\'total_details\') STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "ui_mode" text GENERATED ALWAYS AS ((_raw_data->>\'ui_mode\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "url" text GENERATED ALWAYS AS ((_raw_data->>\'url\')::text) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "wallet_options" jsonb GENERATED ALWAYS AS (_raw_data->\'wallet_options\') STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "name" text GENERATED ALWAYS AS ((_raw_data->>\'name\')::text) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "valid" boolean GENERATED ALWAYS AS ((_raw_data->>\'valid\')::boolean) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((_raw_data->>\'updated\')::integer) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "duration" text GENERATED ALWAYS AS ((_raw_data->>\'duration\')::text) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "redeem_by" integer GENERATED ALWAYS AS ((_raw_data->>\'redeem_by\')::integer) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "amount_off" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_off\')::bigint) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "percent_off" double precision GENERATED ALWAYS AS ((_raw_data->>\'percent_off\')::double precision) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "times_redeemed" bigint GENERATED ALWAYS AS ((_raw_data->>\'times_redeemed\')::bigint) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "max_redemptions" bigint GENERATED ALWAYS AS ((_raw_data->>\'max_redemptions\')::bigint) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "duration_in_months" bigint GENERATED ALWAYS AS ((_raw_data->>\'duration_in_months\')::bigint) STORED;\nALTER TABLE "stripe"."coupons" ADD COLUMN "percent_off_precise" double precision GENERATED ALWAYS AS ((_raw_data->>\'percent_off_precise\')::double precision) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "amount" integer GENERATED ALWAYS AS ((_raw_data->>\'amount\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "amount_shipping" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_shipping\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "customer_balance_transaction" text GENERATED ALWAYS AS ((_raw_data->>\'customer_balance_transaction\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "discount_amount" integer GENERATED ALWAYS AS ((_raw_data->>\'discount_amount\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "discount_amounts" jsonb GENERATED ALWAYS AS (_raw_data->\'discount_amounts\') STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "invoice" text GENERATED ALWAYS AS ((_raw_data->>\'invoice\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "lines" jsonb GENERATED ALWAYS AS (_raw_data->\'lines\') STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "memo" text GENERATED ALWAYS AS ((_raw_data->>\'memo\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "number" text GENERATED ALWAYS AS ((_raw_data->>\'number\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "out_of_band_amount" integer GENERATED ALWAYS AS ((_raw_data->>\'out_of_band_amount\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "pdf" text GENERATED ALWAYS AS ((_raw_data->>\'pdf\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "reason" text GENERATED ALWAYS AS ((_raw_data->>\'reason\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "refund" text GENERATED ALWAYS AS ((_raw_data->>\'refund\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "shipping_cost" jsonb GENERATED ALWAYS AS (_raw_data->\'shipping_cost\') STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "subtotal" integer GENERATED ALWAYS AS ((_raw_data->>\'subtotal\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "subtotal_excluding_tax" integer GENERATED ALWAYS AS ((_raw_data->>\'subtotal_excluding_tax\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "tax_amounts" jsonb GENERATED ALWAYS AS (_raw_data->\'tax_amounts\') STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "total" integer GENERATED ALWAYS AS ((_raw_data->>\'total\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "total_excluding_tax" integer GENERATED ALWAYS AS ((_raw_data->>\'total_excluding_tax\')::integer) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "type" text GENERATED ALWAYS AS ((_raw_data->>\'type\')::text) STORED;\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "voided_at" text GENERATED ALWAYS AS ((_raw_data->>\'voided_at\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "address" jsonb GENERATED ALWAYS AS (_raw_data->\'address\') STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "description" text GENERATED ALWAYS AS ((_raw_data->>\'description\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "email" text GENERATED ALWAYS AS ((_raw_data->>\'email\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "name" text GENERATED ALWAYS AS ((_raw_data->>\'name\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "phone" text GENERATED ALWAYS AS ((_raw_data->>\'phone\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "shipping" jsonb GENERATED ALWAYS AS (_raw_data->\'shipping\') STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "balance" integer GENERATED ALWAYS AS ((_raw_data->>\'balance\')::integer) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "default_source" text GENERATED ALWAYS AS ((_raw_data->>\'default_source\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "delinquent" boolean GENERATED ALWAYS AS ((_raw_data->>\'delinquent\')::boolean) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "discount" jsonb GENERATED ALWAYS AS (_raw_data->\'discount\') STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "invoice_prefix" text GENERATED ALWAYS AS ((_raw_data->>\'invoice_prefix\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "invoice_settings" jsonb GENERATED ALWAYS AS (_raw_data->\'invoice_settings\') STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "next_invoice_sequence" integer GENERATED ALWAYS AS ((_raw_data->>\'next_invoice_sequence\')::integer) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "preferred_locales" jsonb GENERATED ALWAYS AS (_raw_data->\'preferred_locales\') STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "tax_exempt" text GENERATED ALWAYS AS ((_raw_data->>\'tax_exempt\')::text) STORED;\nALTER TABLE "stripe"."customers" ADD COLUMN "deleted" boolean GENERATED ALWAYS AS ((_raw_data->>\'deleted\')::boolean) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount\')::bigint) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "charge" text GENERATED ALWAYS AS ((_raw_data->>\'charge\')::text) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "reason" text GENERATED ALWAYS AS ((_raw_data->>\'reason\')::text) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((_raw_data->>\'updated\')::integer) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "evidence" jsonb GENERATED ALWAYS AS (_raw_data->\'evidence\') STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "evidence_details" jsonb GENERATED ALWAYS AS (_raw_data->\'evidence_details\') STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "balance_transactions" jsonb GENERATED ALWAYS AS (_raw_data->\'balance_transactions\') STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "is_charge_refundable" boolean GENERATED ALWAYS AS ((_raw_data->>\'is_charge_refundable\')::boolean) STORED;\nALTER TABLE "stripe"."disputes" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((_raw_data->>\'payment_intent\')::text) STORED;\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "actionable" boolean GENERATED ALWAYS AS ((_raw_data->>\'actionable\')::boolean) STORED;\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "charge" text GENERATED ALWAYS AS ((_raw_data->>\'charge\')::text) STORED;\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "fraud_type" text GENERATED ALWAYS AS ((_raw_data->>\'fraud_type\')::text) STORED;\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((_raw_data->>\'payment_intent\')::text) STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "data" jsonb GENERATED ALWAYS AS (_raw_data->\'data\') STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "type" text GENERATED ALWAYS AS ((_raw_data->>\'type\')::text) STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "request" text GENERATED ALWAYS AS ((_raw_data->>\'request\')::text) STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((_raw_data->>\'updated\')::integer) STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "api_version" text GENERATED ALWAYS AS ((_raw_data->>\'api_version\')::text) STORED;\nALTER TABLE "stripe"."events" ADD COLUMN "pending_webhooks" bigint GENERATED ALWAYS AS ((_raw_data->>\'pending_webhooks\')::bigint) STORED;\nALTER TABLE "stripe"."features" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."features" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."features" ADD COLUMN "name" text GENERATED ALWAYS AS ((_raw_data->>\'name\')::text) STORED;\nALTER TABLE "stripe"."features" ADD COLUMN "lookup_key" text GENERATED ALWAYS AS ((_raw_data->>\'lookup_key\')::text) STORED;\nALTER TABLE "stripe"."features" ADD COLUMN "active" boolean GENERATED ALWAYS AS ((_raw_data->>\'active\')::boolean) STORED;\nALTER TABLE "stripe"."features" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "auto_advance" boolean GENERATED ALWAYS AS ((_raw_data->>\'auto_advance\')::boolean) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "collection_method" text GENERATED ALWAYS AS ((_raw_data->>\'collection_method\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "description" text GENERATED ALWAYS AS ((_raw_data->>\'description\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "hosted_invoice_url" text GENERATED ALWAYS AS ((_raw_data->>\'hosted_invoice_url\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "lines" jsonb GENERATED ALWAYS AS (_raw_data->\'lines\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "period_end" integer GENERATED ALWAYS AS ((_raw_data->>\'period_end\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "period_start" integer GENERATED ALWAYS AS ((_raw_data->>\'period_start\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "total" bigint GENERATED ALWAYS AS ((_raw_data->>\'total\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "account_country" text GENERATED ALWAYS AS ((_raw_data->>\'account_country\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "account_name" text GENERATED ALWAYS AS ((_raw_data->>\'account_name\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "account_tax_ids" jsonb GENERATED ALWAYS AS (_raw_data->\'account_tax_ids\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "amount_due" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_due\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "amount_paid" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_paid\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "amount_remaining" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_remaining\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "application_fee_amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'application_fee_amount\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "attempt_count" integer GENERATED ALWAYS AS ((_raw_data->>\'attempt_count\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "attempted" boolean GENERATED ALWAYS AS ((_raw_data->>\'attempted\')::boolean) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "billing_reason" text GENERATED ALWAYS AS ((_raw_data->>\'billing_reason\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "custom_fields" jsonb GENERATED ALWAYS AS (_raw_data->\'custom_fields\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_address" jsonb GENERATED ALWAYS AS (_raw_data->\'customer_address\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_email" text GENERATED ALWAYS AS ((_raw_data->>\'customer_email\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_name" text GENERATED ALWAYS AS ((_raw_data->>\'customer_name\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_phone" text GENERATED ALWAYS AS ((_raw_data->>\'customer_phone\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_shipping" jsonb GENERATED ALWAYS AS (_raw_data->\'customer_shipping\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_tax_exempt" text GENERATED ALWAYS AS ((_raw_data->>\'customer_tax_exempt\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer_tax_ids" jsonb GENERATED ALWAYS AS (_raw_data->\'customer_tax_ids\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "default_tax_rates" jsonb GENERATED ALWAYS AS (_raw_data->\'default_tax_rates\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "discount" jsonb GENERATED ALWAYS AS (_raw_data->\'discount\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "discounts" jsonb GENERATED ALWAYS AS (_raw_data->\'discounts\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "due_date" integer GENERATED ALWAYS AS ((_raw_data->>\'due_date\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "ending_balance" integer GENERATED ALWAYS AS ((_raw_data->>\'ending_balance\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "footer" text GENERATED ALWAYS AS ((_raw_data->>\'footer\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "invoice_pdf" text GENERATED ALWAYS AS ((_raw_data->>\'invoice_pdf\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "last_finalization_error" jsonb GENERATED ALWAYS AS (_raw_data->\'last_finalization_error\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "next_payment_attempt" integer GENERATED ALWAYS AS ((_raw_data->>\'next_payment_attempt\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "number" text GENERATED ALWAYS AS ((_raw_data->>\'number\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "paid" boolean GENERATED ALWAYS AS ((_raw_data->>\'paid\')::boolean) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "payment_settings" jsonb GENERATED ALWAYS AS (_raw_data->\'payment_settings\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "post_payment_credit_notes_amount" integer GENERATED ALWAYS AS ((_raw_data->>\'post_payment_credit_notes_amount\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "pre_payment_credit_notes_amount" integer GENERATED ALWAYS AS ((_raw_data->>\'pre_payment_credit_notes_amount\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "receipt_number" text GENERATED ALWAYS AS ((_raw_data->>\'receipt_number\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "starting_balance" integer GENERATED ALWAYS AS ((_raw_data->>\'starting_balance\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((_raw_data->>\'statement_descriptor\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "status_transitions" jsonb GENERATED ALWAYS AS (_raw_data->\'status_transitions\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "subtotal" integer GENERATED ALWAYS AS ((_raw_data->>\'subtotal\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "tax" integer GENERATED ALWAYS AS ((_raw_data->>\'tax\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "total_discount_amounts" jsonb GENERATED ALWAYS AS (_raw_data->\'total_discount_amounts\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "total_tax_amounts" jsonb GENERATED ALWAYS AS (_raw_data->\'total_tax_amounts\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "transfer_data" jsonb GENERATED ALWAYS AS (_raw_data->\'transfer_data\') STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "webhooks_delivered_at" integer GENERATED ALWAYS AS ((_raw_data->>\'webhooks_delivered_at\')::integer) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "subscription" text GENERATED ALWAYS AS ((_raw_data->>\'subscription\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((_raw_data->>\'payment_intent\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "default_payment_method" text GENERATED ALWAYS AS ((_raw_data->>\'default_payment_method\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "default_source" text GENERATED ALWAYS AS ((_raw_data->>\'default_source\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "on_behalf_of" text GENERATED ALWAYS AS ((_raw_data->>\'on_behalf_of\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "charge" text GENERATED ALWAYS AS ((_raw_data->>\'charge\')::text) STORED;\nALTER TABLE "stripe"."invoices" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount" integer GENERATED ALWAYS AS ((_raw_data->>\'amount\')::integer) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount_capturable" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_capturable\')::integer) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount_details" jsonb GENERATED ALWAYS AS (_raw_data->\'amount_details\') STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount_received" integer GENERATED ALWAYS AS ((_raw_data->>\'amount_received\')::integer) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "application" text GENERATED ALWAYS AS ((_raw_data->>\'application\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "application_fee_amount" integer GENERATED ALWAYS AS ((_raw_data->>\'application_fee_amount\')::integer) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "automatic_payment_methods" text GENERATED ALWAYS AS ((_raw_data->>\'automatic_payment_methods\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "canceled_at" integer GENERATED ALWAYS AS ((_raw_data->>\'canceled_at\')::integer) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "cancellation_reason" text GENERATED ALWAYS AS ((_raw_data->>\'cancellation_reason\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "capture_method" text GENERATED ALWAYS AS ((_raw_data->>\'capture_method\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "client_secret" text GENERATED ALWAYS AS ((_raw_data->>\'client_secret\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "confirmation_method" text GENERATED ALWAYS AS ((_raw_data->>\'confirmation_method\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "description" text GENERATED ALWAYS AS ((_raw_data->>\'description\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "invoice" text GENERATED ALWAYS AS ((_raw_data->>\'invoice\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "last_payment_error" text GENERATED ALWAYS AS ((_raw_data->>\'last_payment_error\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "next_action" text GENERATED ALWAYS AS ((_raw_data->>\'next_action\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "on_behalf_of" text GENERATED ALWAYS AS ((_raw_data->>\'on_behalf_of\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "payment_method" text GENERATED ALWAYS AS ((_raw_data->>\'payment_method\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "payment_method_options" jsonb GENERATED ALWAYS AS (_raw_data->\'payment_method_options\') STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "payment_method_types" jsonb GENERATED ALWAYS AS (_raw_data->\'payment_method_types\') STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "processing" text GENERATED ALWAYS AS ((_raw_data->>\'processing\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "receipt_email" text GENERATED ALWAYS AS ((_raw_data->>\'receipt_email\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "review" text GENERATED ALWAYS AS ((_raw_data->>\'review\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "setup_future_usage" text GENERATED ALWAYS AS ((_raw_data->>\'setup_future_usage\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "shipping" jsonb GENERATED ALWAYS AS (_raw_data->\'shipping\') STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((_raw_data->>\'statement_descriptor\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "statement_descriptor_suffix" text GENERATED ALWAYS AS ((_raw_data->>\'statement_descriptor_suffix\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "transfer_data" jsonb GENERATED ALWAYS AS (_raw_data->\'transfer_data\') STORED;\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "transfer_group" text GENERATED ALWAYS AS ((_raw_data->>\'transfer_group\')::text) STORED;\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "type" text GENERATED ALWAYS AS ((_raw_data->>\'type\')::text) STORED;\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "billing_details" jsonb GENERATED ALWAYS AS (_raw_data->\'billing_details\') STORED;\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "card" jsonb GENERATED ALWAYS AS (_raw_data->\'card\') STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "date" text GENERATED ALWAYS AS ((_raw_data->>\'date\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "type" text GENERATED ALWAYS AS ((_raw_data->>\'type\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount\')::bigint) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "method" text GENERATED ALWAYS AS ((_raw_data->>\'method\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((_raw_data->>\'updated\')::integer) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "automatic" boolean GENERATED ALWAYS AS ((_raw_data->>\'automatic\')::boolean) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "recipient" text GENERATED ALWAYS AS ((_raw_data->>\'recipient\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "description" text GENERATED ALWAYS AS ((_raw_data->>\'description\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "destination" text GENERATED ALWAYS AS ((_raw_data->>\'destination\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "source_type" text GENERATED ALWAYS AS ((_raw_data->>\'source_type\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "arrival_date" text GENERATED ALWAYS AS ((_raw_data->>\'arrival_date\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "bank_account" jsonb GENERATED ALWAYS AS (_raw_data->\'bank_account\') STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "failure_code" text GENERATED ALWAYS AS ((_raw_data->>\'failure_code\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "transfer_group" text GENERATED ALWAYS AS ((_raw_data->>\'transfer_group\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "amount_reversed" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_reversed\')::bigint) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "failure_message" text GENERATED ALWAYS AS ((_raw_data->>\'failure_message\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "source_transaction" text GENERATED ALWAYS AS ((_raw_data->>\'source_transaction\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "balance_transaction" text GENERATED ALWAYS AS ((_raw_data->>\'balance_transaction\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((_raw_data->>\'statement_descriptor\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "statement_description" text GENERATED ALWAYS AS ((_raw_data->>\'statement_description\')::text) STORED;\nALTER TABLE "stripe"."payouts" ADD COLUMN "failure_balance_transaction" text GENERATED ALWAYS AS ((_raw_data->>\'failure_balance_transaction\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "name" text GENERATED ALWAYS AS ((_raw_data->>\'name\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "tiers" jsonb GENERATED ALWAYS AS (_raw_data->\'tiers\') STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "active" boolean GENERATED ALWAYS AS ((_raw_data->>\'active\')::boolean) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount\')::bigint) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "product" text GENERATED ALWAYS AS ((_raw_data->>\'product\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((_raw_data->>\'updated\')::integer) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "interval" text GENERATED ALWAYS AS ((_raw_data->>\'interval\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "nickname" text GENERATED ALWAYS AS ((_raw_data->>\'nickname\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "tiers_mode" text GENERATED ALWAYS AS ((_raw_data->>\'tiers_mode\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "usage_type" text GENERATED ALWAYS AS ((_raw_data->>\'usage_type\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "billing_scheme" text GENERATED ALWAYS AS ((_raw_data->>\'billing_scheme\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "interval_count" bigint GENERATED ALWAYS AS ((_raw_data->>\'interval_count\')::bigint) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "aggregate_usage" text GENERATED ALWAYS AS ((_raw_data->>\'aggregate_usage\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "transform_usage" text GENERATED ALWAYS AS ((_raw_data->>\'transform_usage\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "trial_period_days" bigint GENERATED ALWAYS AS ((_raw_data->>\'trial_period_days\')::bigint) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((_raw_data->>\'statement_descriptor\')::text) STORED;\nALTER TABLE "stripe"."plans" ADD COLUMN "statement_description" text GENERATED ALWAYS AS ((_raw_data->>\'statement_description\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "active" boolean GENERATED ALWAYS AS ((_raw_data->>\'active\')::boolean) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "nickname" text GENERATED ALWAYS AS ((_raw_data->>\'nickname\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "recurring" jsonb GENERATED ALWAYS AS (_raw_data->\'recurring\') STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "type" text GENERATED ALWAYS AS ((_raw_data->>\'type\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "unit_amount" integer GENERATED ALWAYS AS ((_raw_data->>\'unit_amount\')::integer) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "billing_scheme" text GENERATED ALWAYS AS ((_raw_data->>\'billing_scheme\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "lookup_key" text GENERATED ALWAYS AS ((_raw_data->>\'lookup_key\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "tiers_mode" text GENERATED ALWAYS AS ((_raw_data->>\'tiers_mode\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "transform_quantity" jsonb GENERATED ALWAYS AS (_raw_data->\'transform_quantity\') STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "unit_amount_decimal" text GENERATED ALWAYS AS ((_raw_data->>\'unit_amount_decimal\')::text) STORED;\nALTER TABLE "stripe"."prices" ADD COLUMN "product" text GENERATED ALWAYS AS ((_raw_data->>\'product\')::text) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "active" boolean GENERATED ALWAYS AS ((_raw_data->>\'active\')::boolean) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "default_price" text GENERATED ALWAYS AS ((_raw_data->>\'default_price\')::text) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "description" text GENERATED ALWAYS AS ((_raw_data->>\'description\')::text) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "name" text GENERATED ALWAYS AS ((_raw_data->>\'name\')::text) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "images" jsonb GENERATED ALWAYS AS (_raw_data->\'images\') STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "marketing_features" jsonb GENERATED ALWAYS AS (_raw_data->\'marketing_features\') STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "package_dimensions" jsonb GENERATED ALWAYS AS (_raw_data->\'package_dimensions\') STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "shippable" boolean GENERATED ALWAYS AS ((_raw_data->>\'shippable\')::boolean) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "statement_descriptor" text GENERATED ALWAYS AS ((_raw_data->>\'statement_descriptor\')::text) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "unit_label" text GENERATED ALWAYS AS ((_raw_data->>\'unit_label\')::text) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "updated" integer GENERATED ALWAYS AS ((_raw_data->>\'updated\')::integer) STORED;\nALTER TABLE "stripe"."products" ADD COLUMN "url" text GENERATED ALWAYS AS ((_raw_data->>\'url\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "amount" integer GENERATED ALWAYS AS ((_raw_data->>\'amount\')::integer) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "balance_transaction" text GENERATED ALWAYS AS ((_raw_data->>\'balance_transaction\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "charge" text GENERATED ALWAYS AS ((_raw_data->>\'charge\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "currency" text GENERATED ALWAYS AS ((_raw_data->>\'currency\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "destination_details" jsonb GENERATED ALWAYS AS (_raw_data->\'destination_details\') STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((_raw_data->>\'payment_intent\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "reason" text GENERATED ALWAYS AS ((_raw_data->>\'reason\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "receipt_number" text GENERATED ALWAYS AS ((_raw_data->>\'receipt_number\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "source_transfer_reversal" text GENERATED ALWAYS AS ((_raw_data->>\'source_transfer_reversal\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."refunds" ADD COLUMN "transfer_reversal" text GENERATED ALWAYS AS ((_raw_data->>\'transfer_reversal\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "billing_zip" text GENERATED ALWAYS AS ((_raw_data->>\'billing_zip\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "charge" text GENERATED ALWAYS AS ((_raw_data->>\'charge\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "closed_reason" text GENERATED ALWAYS AS ((_raw_data->>\'closed_reason\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "ip_address" text GENERATED ALWAYS AS ((_raw_data->>\'ip_address\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "ip_address_location" jsonb GENERATED ALWAYS AS (_raw_data->\'ip_address_location\') STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "open" boolean GENERATED ALWAYS AS ((_raw_data->>\'open\')::boolean) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "opened_reason" text GENERATED ALWAYS AS ((_raw_data->>\'opened_reason\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "payment_intent" text GENERATED ALWAYS AS ((_raw_data->>\'payment_intent\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "reason" text GENERATED ALWAYS AS ((_raw_data->>\'reason\')::text) STORED;\nALTER TABLE "stripe"."reviews" ADD COLUMN "session" text GENERATED ALWAYS AS ((_raw_data->>\'session\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "description" text GENERATED ALWAYS AS ((_raw_data->>\'description\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "payment_method" text GENERATED ALWAYS AS ((_raw_data->>\'payment_method\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "usage" text GENERATED ALWAYS AS ((_raw_data->>\'usage\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "cancellation_reason" text GENERATED ALWAYS AS ((_raw_data->>\'cancellation_reason\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "latest_attempt" text GENERATED ALWAYS AS ((_raw_data->>\'latest_attempt\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "mandate" text GENERATED ALWAYS AS ((_raw_data->>\'mandate\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "single_use_mandate" text GENERATED ALWAYS AS ((_raw_data->>\'single_use_mandate\')::text) STORED;\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "on_behalf_of" text GENERATED ALWAYS AS ((_raw_data->>\'on_behalf_of\')::text) STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "billing_thresholds" jsonb GENERATED ALWAYS AS (_raw_data->\'billing_thresholds\') STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "deleted" boolean GENERATED ALWAYS AS ((_raw_data->>\'deleted\')::boolean) STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "quantity" integer GENERATED ALWAYS AS ((_raw_data->>\'quantity\')::integer) STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "price" text GENERATED ALWAYS AS ((_raw_data->>\'price\')::text) STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "subscription" text GENERATED ALWAYS AS ((_raw_data->>\'subscription\')::text) STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "tax_rates" jsonb GENERATED ALWAYS AS (_raw_data->\'tax_rates\') STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "current_period_end" integer GENERATED ALWAYS AS ((_raw_data->>\'current_period_end\')::integer) STORED;\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "current_period_start" integer GENERATED ALWAYS AS ((_raw_data->>\'current_period_start\')::integer) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "application" text GENERATED ALWAYS AS ((_raw_data->>\'application\')::text) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "canceled_at" integer GENERATED ALWAYS AS ((_raw_data->>\'canceled_at\')::integer) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "completed_at" integer GENERATED ALWAYS AS ((_raw_data->>\'completed_at\')::integer) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "current_phase" jsonb GENERATED ALWAYS AS (_raw_data->\'current_phase\') STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "default_settings" jsonb GENERATED ALWAYS AS (_raw_data->\'default_settings\') STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "end_behavior" text GENERATED ALWAYS AS ((_raw_data->>\'end_behavior\')::text) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "phases" jsonb GENERATED ALWAYS AS (_raw_data->\'phases\') STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "released_at" integer GENERATED ALWAYS AS ((_raw_data->>\'released_at\')::integer) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "released_subscription" text GENERATED ALWAYS AS ((_raw_data->>\'released_subscription\')::text) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "subscription" text GENERATED ALWAYS AS ((_raw_data->>\'subscription\')::text) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "test_clock" text GENERATED ALWAYS AS ((_raw_data->>\'test_clock\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "cancel_at_period_end" boolean GENERATED ALWAYS AS ((_raw_data->>\'cancel_at_period_end\')::boolean) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "current_period_end" integer GENERATED ALWAYS AS ((_raw_data->>\'current_period_end\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "current_period_start" integer GENERATED ALWAYS AS ((_raw_data->>\'current_period_start\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "default_payment_method" text GENERATED ALWAYS AS ((_raw_data->>\'default_payment_method\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "items" jsonb GENERATED ALWAYS AS (_raw_data->\'items\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "metadata" jsonb GENERATED ALWAYS AS (_raw_data->\'metadata\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "pending_setup_intent" text GENERATED ALWAYS AS ((_raw_data->>\'pending_setup_intent\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "pending_update" jsonb GENERATED ALWAYS AS (_raw_data->\'pending_update\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "status" text GENERATED ALWAYS AS ((_raw_data->>\'status\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "application_fee_percent" double precision GENERATED ALWAYS AS ((_raw_data->>\'application_fee_percent\')::double precision) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "billing_cycle_anchor" integer GENERATED ALWAYS AS ((_raw_data->>\'billing_cycle_anchor\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "billing_thresholds" jsonb GENERATED ALWAYS AS (_raw_data->\'billing_thresholds\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "cancel_at" integer GENERATED ALWAYS AS ((_raw_data->>\'cancel_at\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "canceled_at" integer GENERATED ALWAYS AS ((_raw_data->>\'canceled_at\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "collection_method" text GENERATED ALWAYS AS ((_raw_data->>\'collection_method\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "days_until_due" integer GENERATED ALWAYS AS ((_raw_data->>\'days_until_due\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "default_source" text GENERATED ALWAYS AS ((_raw_data->>\'default_source\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "default_tax_rates" jsonb GENERATED ALWAYS AS (_raw_data->\'default_tax_rates\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "discount" jsonb GENERATED ALWAYS AS (_raw_data->\'discount\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "ended_at" integer GENERATED ALWAYS AS ((_raw_data->>\'ended_at\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "next_pending_invoice_item_invoice" integer GENERATED ALWAYS AS ((_raw_data->>\'next_pending_invoice_item_invoice\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "pause_collection" jsonb GENERATED ALWAYS AS (_raw_data->\'pause_collection\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "pending_invoice_item_interval" jsonb GENERATED ALWAYS AS (_raw_data->\'pending_invoice_item_interval\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "start_date" integer GENERATED ALWAYS AS ((_raw_data->>\'start_date\')::integer) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "transfer_data" jsonb GENERATED ALWAYS AS (_raw_data->\'transfer_data\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "trial_end" jsonb GENERATED ALWAYS AS (_raw_data->\'trial_end\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "trial_start" jsonb GENERATED ALWAYS AS (_raw_data->\'trial_start\') STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "schedule" text GENERATED ALWAYS AS ((_raw_data->>\'schedule\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "latest_invoice" text GENERATED ALWAYS AS ((_raw_data->>\'latest_invoice\')::text) STORED;\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "plan" text GENERATED ALWAYS AS ((_raw_data->>\'plan\')::text) STORED;\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "object" text GENERATED ALWAYS AS ((_raw_data->>\'object\')::text) STORED;\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "country" text GENERATED ALWAYS AS ((_raw_data->>\'country\')::text) STORED;\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "customer" text GENERATED ALWAYS AS ((_raw_data->>\'customer\')::text) STORED;\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "type" text GENERATED ALWAYS AS ((_raw_data->>\'type\')::text) STORED;\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "value" text GENERATED ALWAYS AS ((_raw_data->>\'value\')::text) STORED;\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "created" integer GENERATED ALWAYS AS ((_raw_data->>\'created\')::integer) STORED;\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "livemode" boolean GENERATED ALWAYS AS ((_raw_data->>\'livemode\')::boolean) STORED;\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "owner" jsonb GENERATED ALWAYS AS (_raw_data->\'owner\') STORED;\n\n-- ============================================================================\n-- STEP 3: RECREATE INDEXES\n-- ============================================================================\n\nCREATE INDEX stripe_active_entitlements_customer_idx ON "stripe"."active_entitlements" USING btree (customer);\nCREATE INDEX stripe_active_entitlements_feature_idx ON "stripe"."active_entitlements" USING btree (feature);\nCREATE UNIQUE INDEX active_entitlements_lookup_key_key ON "stripe"."active_entitlements" (lookup_key) WHERE lookup_key IS NOT NULL;\nCREATE INDEX stripe_checkout_session_line_items_session_idx ON "stripe"."checkout_session_line_items" USING btree (checkout_session);\nCREATE INDEX stripe_checkout_session_line_items_price_idx ON "stripe"."checkout_session_line_items" USING btree (price);\nCREATE INDEX stripe_checkout_sessions_customer_idx ON "stripe"."checkout_sessions" USING btree (customer);\nCREATE INDEX stripe_checkout_sessions_subscription_idx ON "stripe"."checkout_sessions" USING btree (subscription);\nCREATE INDEX stripe_checkout_sessions_payment_intent_idx ON "stripe"."checkout_sessions" USING btree (payment_intent);\nCREATE INDEX stripe_checkout_sessions_invoice_idx ON "stripe"."checkout_sessions" USING btree (invoice);\nCREATE INDEX stripe_credit_notes_customer_idx ON "stripe"."credit_notes" USING btree (customer);\nCREATE INDEX stripe_credit_notes_invoice_idx ON "stripe"."credit_notes" USING btree (invoice);\nCREATE INDEX stripe_dispute_created_idx ON "stripe"."disputes" USING btree (created);\nCREATE INDEX stripe_early_fraud_warnings_charge_idx ON "stripe"."early_fraud_warnings" USING btree (charge);\nCREATE INDEX stripe_early_fraud_warnings_payment_intent_idx ON "stripe"."early_fraud_warnings" USING btree (payment_intent);\nCREATE UNIQUE INDEX features_lookup_key_key ON "stripe"."features" (lookup_key) WHERE lookup_key IS NOT NULL;\nCREATE INDEX stripe_invoices_customer_idx ON "stripe"."invoices" USING btree (customer);\nCREATE INDEX stripe_invoices_subscription_idx ON "stripe"."invoices" USING btree (subscription);\nCREATE INDEX stripe_payment_intents_customer_idx ON "stripe"."payment_intents" USING btree (customer);\nCREATE INDEX stripe_payment_intents_invoice_idx ON "stripe"."payment_intents" USING btree (invoice);\nCREATE INDEX stripe_payment_methods_customer_idx ON "stripe"."payment_methods" USING btree (customer);\nCREATE INDEX stripe_refunds_charge_idx ON "stripe"."refunds" USING btree (charge);\nCREATE INDEX stripe_refunds_payment_intent_idx ON "stripe"."refunds" USING btree (payment_intent);\nCREATE INDEX stripe_reviews_charge_idx ON "stripe"."reviews" USING btree (charge);\nCREATE INDEX stripe_reviews_payment_intent_idx ON "stripe"."reviews" USING btree (payment_intent);\nCREATE INDEX stripe_setup_intents_customer_idx ON "stripe"."setup_intents" USING btree (customer);\nCREATE INDEX stripe_tax_ids_customer_idx ON "stripe"."tax_ids" USING btree (customer);\n',
  },
  {
    name: '0049_remove_redundant_underscores_from_metadata_tables.sql',
    sql: '-- Remove redundant underscore prefixes from columns in metadata tables\n--\n-- For tables that are already prefixed with underscore (indicating they are\n-- metadata/system tables), the underscore prefix on columns is redundant.\n-- This migration removes those redundant prefixes to keep naming cleaner.\n--\n-- Affected tables: _sync_status, _managed_webhooks\n\n-- Create a new trigger function for metadata tables that references updated_at without underscore\nCREATE OR REPLACE FUNCTION set_updated_at_metadata() RETURNS trigger\n    LANGUAGE plpgsql\nAS $$\nbegin\n  new.updated_at = now();\n  return NEW;\nend;\n$$;\n\n-- Update _sync_status table\n-- Step 1: Drop constraints and triggers that reference the old column names\nDROP TRIGGER IF EXISTS handle_updated_at ON "stripe"."_sync_status";\nALTER TABLE "stripe"."_sync_status" DROP CONSTRAINT IF EXISTS _sync_status_resource_account_key;\nALTER TABLE "stripe"."_sync_status" DROP CONSTRAINT IF EXISTS fk_sync_status_account;\nDROP INDEX IF EXISTS "stripe"."idx_sync_status_resource_account";\n\n-- Step 2: Rename columns\nALTER TABLE "stripe"."_sync_status" RENAME COLUMN "_id" TO "id";\nALTER TABLE "stripe"."_sync_status" RENAME COLUMN "_last_synced_at" TO "last_synced_at";\nALTER TABLE "stripe"."_sync_status" RENAME COLUMN "_updated_at" TO "updated_at";\nALTER TABLE "stripe"."_sync_status" RENAME COLUMN "_account_id" TO "account_id";\n\n-- Step 3: Recreate constraints and trigger with new column names\nALTER TABLE "stripe"."_sync_status"\n  ADD CONSTRAINT _sync_status_resource_account_key\n  UNIQUE (resource, "account_id");\n\nCREATE INDEX IF NOT EXISTS idx_sync_status_resource_account\n  ON "stripe"."_sync_status" (resource, "account_id");\n\nALTER TABLE "stripe"."_sync_status"\n  ADD CONSTRAINT fk_sync_status_account\n  FOREIGN KEY ("account_id") REFERENCES "stripe"."accounts" ("_id");\n\nCREATE TRIGGER handle_updated_at\n  BEFORE UPDATE ON "stripe"."_sync_status"\n  FOR EACH ROW\n  EXECUTE PROCEDURE set_updated_at_metadata();\n\n-- Update _managed_webhooks table\n-- Step 1: Drop constraints and triggers that reference the old column names\nDROP TRIGGER IF EXISTS handle_updated_at ON "stripe"."_managed_webhooks";\nALTER TABLE "stripe"."_managed_webhooks" DROP CONSTRAINT IF EXISTS fk_managed_webhooks_account;\n\n-- Step 2: Rename columns\nALTER TABLE "stripe"."_managed_webhooks" RENAME COLUMN "_id" TO "id";\nALTER TABLE "stripe"."_managed_webhooks" RENAME COLUMN "_last_synced_at" TO "last_synced_at";\nALTER TABLE "stripe"."_managed_webhooks" RENAME COLUMN "_updated_at" TO "updated_at";\nALTER TABLE "stripe"."_managed_webhooks" RENAME COLUMN "_account_id" TO "account_id";\n\n-- Step 3: Recreate foreign key constraint and trigger with new column names\nALTER TABLE "stripe"."_managed_webhooks"\n  ADD CONSTRAINT fk_managed_webhooks_account\n  FOREIGN KEY ("account_id") REFERENCES "stripe"."accounts" ("_id");\n\nCREATE TRIGGER handle_updated_at\n  BEFORE UPDATE ON "stripe"."_managed_webhooks"\n  FOR EACH ROW\n  EXECUTE PROCEDURE set_updated_at_metadata();\n',
  },
  {
    name: '0050_rename_id_to_match_stripe_api.sql',
    sql: '-- Rename _id back to id to match Stripe API field names\n--\n-- Migration 0048 added underscore prefixes to all "reserved" columns including id.\n-- However, id is actually a field that comes directly from the Stripe API and should\n-- match the API naming for agent/user comprehension.\n--\n-- Additionally, this migration converts id from a regular column to a GENERATED column\n-- derived from _raw_data->>\'id\', ensuring the raw_data is the single source of truth.\n\n-- ============================================================================\n-- Step 1: Drop all foreign key constraints referencing accounts._id\n-- ============================================================================\n\nALTER TABLE "stripe"."active_entitlements" DROP CONSTRAINT IF EXISTS fk_active_entitlements_account;\nALTER TABLE "stripe"."charges" DROP CONSTRAINT IF EXISTS fk_charges_account;\nALTER TABLE "stripe"."checkout_session_line_items" DROP CONSTRAINT IF EXISTS fk_checkout_session_line_items_account;\nALTER TABLE "stripe"."checkout_sessions" DROP CONSTRAINT IF EXISTS fk_checkout_sessions_account;\nALTER TABLE "stripe"."credit_notes" DROP CONSTRAINT IF EXISTS fk_credit_notes_account;\nALTER TABLE "stripe"."customers" DROP CONSTRAINT IF EXISTS fk_customers_account;\nALTER TABLE "stripe"."disputes" DROP CONSTRAINT IF EXISTS fk_disputes_account;\nALTER TABLE "stripe"."early_fraud_warnings" DROP CONSTRAINT IF EXISTS fk_early_fraud_warnings_account;\nALTER TABLE "stripe"."features" DROP CONSTRAINT IF EXISTS fk_features_account;\nALTER TABLE "stripe"."invoices" DROP CONSTRAINT IF EXISTS fk_invoices_account;\nALTER TABLE "stripe"."_managed_webhooks" DROP CONSTRAINT IF EXISTS fk_managed_webhooks_account;\nALTER TABLE "stripe"."payment_intents" DROP CONSTRAINT IF EXISTS fk_payment_intents_account;\nALTER TABLE "stripe"."payment_methods" DROP CONSTRAINT IF EXISTS fk_payment_methods_account;\nALTER TABLE "stripe"."plans" DROP CONSTRAINT IF EXISTS fk_plans_account;\nALTER TABLE "stripe"."prices" DROP CONSTRAINT IF EXISTS fk_prices_account;\nALTER TABLE "stripe"."products" DROP CONSTRAINT IF EXISTS fk_products_account;\nALTER TABLE "stripe"."refunds" DROP CONSTRAINT IF EXISTS fk_refunds_account;\nALTER TABLE "stripe"."reviews" DROP CONSTRAINT IF EXISTS fk_reviews_account;\nALTER TABLE "stripe"."setup_intents" DROP CONSTRAINT IF EXISTS fk_setup_intents_account;\nALTER TABLE "stripe"."subscription_items" DROP CONSTRAINT IF EXISTS fk_subscription_items_account;\nALTER TABLE "stripe"."subscription_schedules" DROP CONSTRAINT IF EXISTS fk_subscription_schedules_account;\nALTER TABLE "stripe"."subscriptions" DROP CONSTRAINT IF EXISTS fk_subscriptions_account;\nALTER TABLE "stripe"."tax_ids" DROP CONSTRAINT IF EXISTS fk_tax_ids_account;\nALTER TABLE "stripe"."_sync_status" DROP CONSTRAINT IF EXISTS fk_sync_status_account;\n\n-- ============================================================================\n-- Step 2: Convert accounts._id to generated column accounts.id\n-- ============================================================================\n\nALTER TABLE "stripe"."accounts" DROP CONSTRAINT IF EXISTS accounts_pkey;\nALTER TABLE "stripe"."accounts" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."accounts" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."accounts" ADD PRIMARY KEY (id);\n\n-- ============================================================================\n-- Step 3: Convert _id to generated column id for all Stripe entity tables\n-- ============================================================================\n\n-- active_entitlements\nALTER TABLE "stripe"."active_entitlements" DROP CONSTRAINT IF EXISTS active_entitlements_pkey;\nALTER TABLE "stripe"."active_entitlements" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."active_entitlements" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."active_entitlements" ADD PRIMARY KEY (id);\n\n-- charges\nALTER TABLE "stripe"."charges" DROP CONSTRAINT IF EXISTS charges_pkey;\nALTER TABLE "stripe"."charges" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."charges" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."charges" ADD PRIMARY KEY (id);\n\n-- checkout_session_line_items\nALTER TABLE "stripe"."checkout_session_line_items" DROP CONSTRAINT IF EXISTS checkout_session_line_items_pkey;\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" ADD PRIMARY KEY (id);\n\n-- checkout_sessions\nALTER TABLE "stripe"."checkout_sessions" DROP CONSTRAINT IF EXISTS checkout_sessions_pkey;\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."checkout_sessions" ADD PRIMARY KEY (id);\n\n-- credit_notes\nALTER TABLE "stripe"."credit_notes" DROP CONSTRAINT IF EXISTS credit_notes_pkey;\nALTER TABLE "stripe"."credit_notes" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."credit_notes" ADD PRIMARY KEY (id);\n\n-- coupons\nALTER TABLE "stripe"."coupons" DROP CONSTRAINT IF EXISTS coupons_pkey;\nALTER TABLE "stripe"."coupons" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."coupons" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."coupons" ADD PRIMARY KEY (id);\n\n-- customers\nALTER TABLE "stripe"."customers" DROP CONSTRAINT IF EXISTS customers_pkey;\nALTER TABLE "stripe"."customers" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."customers" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."customers" ADD PRIMARY KEY (id);\n\n-- disputes\nALTER TABLE "stripe"."disputes" DROP CONSTRAINT IF EXISTS disputes_pkey;\nALTER TABLE "stripe"."disputes" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."disputes" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."disputes" ADD PRIMARY KEY (id);\n\n-- early_fraud_warnings\nALTER TABLE "stripe"."early_fraud_warnings" DROP CONSTRAINT IF EXISTS early_fraud_warnings_pkey;\nALTER TABLE "stripe"."early_fraud_warnings" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."early_fraud_warnings" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."early_fraud_warnings" ADD PRIMARY KEY (id);\n\n-- events\nALTER TABLE "stripe"."events" DROP CONSTRAINT IF EXISTS events_pkey;\nALTER TABLE "stripe"."events" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."events" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."events" ADD PRIMARY KEY (id);\n\n-- features\nALTER TABLE "stripe"."features" DROP CONSTRAINT IF EXISTS features_pkey;\nALTER TABLE "stripe"."features" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."features" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."features" ADD PRIMARY KEY (id);\n\n-- invoices\nALTER TABLE "stripe"."invoices" DROP CONSTRAINT IF EXISTS invoices_pkey;\nALTER TABLE "stripe"."invoices" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."invoices" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."invoices" ADD PRIMARY KEY (id);\n\n-- payment_intents\nALTER TABLE "stripe"."payment_intents" DROP CONSTRAINT IF EXISTS payment_intents_pkey;\nALTER TABLE "stripe"."payment_intents" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."payment_intents" ADD PRIMARY KEY (id);\n\n-- payment_methods\nALTER TABLE "stripe"."payment_methods" DROP CONSTRAINT IF EXISTS payment_methods_pkey;\nALTER TABLE "stripe"."payment_methods" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."payment_methods" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."payment_methods" ADD PRIMARY KEY (id);\n\n-- payouts\nALTER TABLE "stripe"."payouts" DROP CONSTRAINT IF EXISTS payouts_pkey;\nALTER TABLE "stripe"."payouts" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."payouts" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."payouts" ADD PRIMARY KEY (id);\n\n-- plans\nALTER TABLE "stripe"."plans" DROP CONSTRAINT IF EXISTS plans_pkey;\nALTER TABLE "stripe"."plans" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."plans" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."plans" ADD PRIMARY KEY (id);\n\n-- prices\nALTER TABLE "stripe"."prices" DROP CONSTRAINT IF EXISTS prices_pkey;\nALTER TABLE "stripe"."prices" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."prices" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."prices" ADD PRIMARY KEY (id);\n\n-- products\nALTER TABLE "stripe"."products" DROP CONSTRAINT IF EXISTS products_pkey;\nALTER TABLE "stripe"."products" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."products" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."products" ADD PRIMARY KEY (id);\n\n-- refunds\nALTER TABLE "stripe"."refunds" DROP CONSTRAINT IF EXISTS refunds_pkey;\nALTER TABLE "stripe"."refunds" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."refunds" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."refunds" ADD PRIMARY KEY (id);\n\n-- reviews\nALTER TABLE "stripe"."reviews" DROP CONSTRAINT IF EXISTS reviews_pkey;\nALTER TABLE "stripe"."reviews" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."reviews" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."reviews" ADD PRIMARY KEY (id);\n\n-- setup_intents\nALTER TABLE "stripe"."setup_intents" DROP CONSTRAINT IF EXISTS setup_intents_pkey;\nALTER TABLE "stripe"."setup_intents" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."setup_intents" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."setup_intents" ADD PRIMARY KEY (id);\n\n-- subscription_items\nALTER TABLE "stripe"."subscription_items" DROP CONSTRAINT IF EXISTS subscription_items_pkey;\nALTER TABLE "stripe"."subscription_items" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."subscription_items" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."subscription_items" ADD PRIMARY KEY (id);\n\n-- subscription_schedules\nALTER TABLE "stripe"."subscription_schedules" DROP CONSTRAINT IF EXISTS subscription_schedules_pkey;\nALTER TABLE "stripe"."subscription_schedules" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."subscription_schedules" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."subscription_schedules" ADD PRIMARY KEY (id);\n\n-- subscriptions\nALTER TABLE "stripe"."subscriptions" DROP CONSTRAINT IF EXISTS subscriptions_pkey;\nALTER TABLE "stripe"."subscriptions" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."subscriptions" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."subscriptions" ADD PRIMARY KEY (id);\n\n-- tax_ids\nALTER TABLE "stripe"."tax_ids" DROP CONSTRAINT IF EXISTS tax_ids_pkey;\nALTER TABLE "stripe"."tax_ids" DROP COLUMN IF EXISTS "_id";\nALTER TABLE "stripe"."tax_ids" ADD COLUMN "id" TEXT GENERATED ALWAYS AS ((_raw_data->>\'id\')::TEXT) STORED;\nALTER TABLE "stripe"."tax_ids" ADD PRIMARY KEY (id);\n\n-- ============================================================================\n-- Step 4: Handle metadata tables\n-- ============================================================================\n\n-- _managed_webhooks (internal metadata table, doesn\'t use _raw_data pattern)\n-- Already uses "id" without underscore (migration 0049), no changes needed\n\n-- _sync_status (internal table, uses auto-incrementing id not from Stripe)\n-- Already uses "id" without underscore (migration 0049), no changes needed\n\n-- ============================================================================\n-- Step 5: Recreate all foreign key constraints\n-- ============================================================================\n\nALTER TABLE "stripe"."active_entitlements" ADD CONSTRAINT fk_active_entitlements_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."charges" ADD CONSTRAINT fk_charges_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."checkout_session_line_items" ADD CONSTRAINT fk_checkout_session_line_items_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."checkout_sessions" ADD CONSTRAINT fk_checkout_sessions_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."credit_notes" ADD CONSTRAINT fk_credit_notes_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."customers" ADD CONSTRAINT fk_customers_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."disputes" ADD CONSTRAINT fk_disputes_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."early_fraud_warnings" ADD CONSTRAINT fk_early_fraud_warnings_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."features" ADD CONSTRAINT fk_features_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."invoices" ADD CONSTRAINT fk_invoices_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."_managed_webhooks" ADD CONSTRAINT fk_managed_webhooks_account FOREIGN KEY ("account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."payment_intents" ADD CONSTRAINT fk_payment_intents_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."payment_methods" ADD CONSTRAINT fk_payment_methods_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."plans" ADD CONSTRAINT fk_plans_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."prices" ADD CONSTRAINT fk_prices_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."products" ADD CONSTRAINT fk_products_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."refunds" ADD CONSTRAINT fk_refunds_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."reviews" ADD CONSTRAINT fk_reviews_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."setup_intents" ADD CONSTRAINT fk_setup_intents_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."subscription_items" ADD CONSTRAINT fk_subscription_items_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."subscription_schedules" ADD CONSTRAINT fk_subscription_schedules_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."subscriptions" ADD CONSTRAINT fk_subscriptions_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."tax_ids" ADD CONSTRAINT fk_tax_ids_account FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\nALTER TABLE "stripe"."_sync_status" ADD CONSTRAINT fk_sync_status_account FOREIGN KEY ("account_id") REFERENCES "stripe"."accounts" (id);\n',
  },
  {
    name: '0051_remove_webhook_uuid.sql',
    sql: '-- Remove UUID from managed webhooks\n-- UUID-based routing is no longer used; webhooks are identified by exact URL match\n-- Legacy webhooks with UUID in URL will be automatically deleted and recreated\n\ndrop index if exists "stripe"."stripe_managed_webhooks_uuid_idx";\n\nalter table "stripe"."_managed_webhooks" drop column if exists "uuid";\n',
  },
  {
    name: '0052_webhook_url_uniqueness.sql',
    sql: '-- Add unique constraint on URL per account to prevent duplicate webhooks at database level\n-- This prevents race conditions where multiple instances try to create webhooks for the same URL\n-- Since UUIDs have been removed from URLs, we can enforce strict uniqueness on the URL column per account\n-- Note: Different accounts can have webhooks with the same URL\n\nalter table "stripe"."_managed_webhooks"\n  add constraint managed_webhooks_url_account_unique unique ("url", "account_id");\n',
  },
  {
    name: '0053_sync_observability.sql',
    sql: '-- Observable Sync System: Track sync runs and individual object syncs\n-- Enables observability for long-running syncs (days, not minutes)\n--\n-- Two-level hierarchy:\n--   _sync_run: Parent sync operation (one active per account)\n--   _sync_obj_run: Individual object syncs within a run\n--\n-- Features:\n--   - Only one active run per account (EXCLUDE constraint)\n--   - Configurable object concurrency (max_concurrent)\n--   - Stale detection (is_stale in dashboard view)\n--   - Progress tracking per object\n\n-- Step 1: Create _sync_run table (parent sync operation)\nCREATE TABLE IF NOT EXISTS "stripe"."_sync_run" (\n  "_account_id" TEXT NOT NULL,\n  started_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n  status TEXT NOT NULL DEFAULT \'running\' CHECK (status IN (\'running\', \'complete\', \'error\')),\n  max_concurrent INTEGER NOT NULL DEFAULT 3,\n  completed_at TIMESTAMPTZ,\n  error_message TEXT,\n  triggered_by TEXT,\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n\n  PRIMARY KEY ("_account_id", started_at),\n\n  -- Only one active run per account\n  CONSTRAINT one_active_run_per_account\n    EXCLUDE ("_account_id" WITH =) WHERE (status = \'running\'),\n\n  -- Foreign key to accounts table\n  CONSTRAINT fk_sync_run_account\n    FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id)\n);\n\n-- Step 2: Add updated_at trigger for _sync_run\n-- Use set_updated_at_metadata() since this is a metadata table with updated_at (not _updated_at)\nCREATE TRIGGER handle_updated_at\n  BEFORE UPDATE ON "stripe"."_sync_run"\n  FOR EACH ROW\n  EXECUTE PROCEDURE set_updated_at_metadata();\n\n-- Step 3: Create _sync_obj_run table (individual object syncs)\nCREATE TABLE IF NOT EXISTS "stripe"."_sync_obj_run" (\n  "_account_id" TEXT NOT NULL,\n  run_started_at TIMESTAMPTZ NOT NULL,\n  object TEXT NOT NULL,\n  status TEXT NOT NULL DEFAULT \'pending\' CHECK (status IN (\'pending\', \'running\', \'complete\', \'error\')),\n  started_at TIMESTAMPTZ,\n  completed_at TIMESTAMPTZ,\n  processed_count INTEGER DEFAULT 0,\n  cursor TEXT,\n  error_message TEXT,\n  updated_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n\n  PRIMARY KEY ("_account_id", run_started_at, object),\n\n  -- Foreign key to parent sync run\n  CONSTRAINT fk_sync_obj_run_parent\n    FOREIGN KEY ("_account_id", run_started_at) REFERENCES "stripe"."_sync_run" ("_account_id", started_at)\n);\n\n-- Step 4: Add updated_at trigger for _sync_obj_run\n-- Use set_updated_at_metadata() since this is a metadata table with updated_at (not _updated_at)\nCREATE TRIGGER handle_updated_at\n  BEFORE UPDATE ON "stripe"."_sync_obj_run"\n  FOR EACH ROW\n  EXECUTE PROCEDURE set_updated_at_metadata();\n\n-- Step 5: Create indexes for efficient queries\nCREATE INDEX IF NOT EXISTS idx_sync_run_account_status\n  ON "stripe"."_sync_run" ("_account_id", status);\n\nCREATE INDEX IF NOT EXISTS idx_sync_obj_run_status\n  ON "stripe"."_sync_obj_run" ("_account_id", run_started_at, status);\n\n-- Step 6: Create sync_dashboard view for observability\nCREATE OR REPLACE VIEW "stripe"."sync_dashboard" AS\nSELECT\n  r."_account_id" as account_id,\n  r.started_at as run_started_at,\n  r.status as run_status,\n  r.completed_at as run_completed_at,\n  r.max_concurrent,\n  r.triggered_by,\n  o.object,\n  o.status as object_status,\n  o.started_at as object_started_at,\n  o.completed_at as object_completed_at,\n  o.processed_count,\n  o.error_message,\n  o.updated_at,\n  -- Duration in seconds\n  EXTRACT(EPOCH FROM (COALESCE(o.completed_at, now()) - o.started_at))::integer as duration_seconds,\n  -- Stale detection: running but no update in 5 min\n  CASE\n    WHEN o.status = \'running\' AND o.updated_at < now() - interval \'5 minutes\'\n    THEN true\n    ELSE false\n  END as is_stale\nFROM "stripe"."_sync_run" r\nLEFT JOIN "stripe"."_sync_obj_run" o\n  ON o."_account_id" = r."_account_id"\n  AND o.run_started_at = r.started_at;\n',
  },
  {
    name: '0054_drop_sync_status.sql',
    sql: '-- Drop the old _sync_status table\n-- This table has been replaced by _sync_run and _sync_obj_run for better observability\n-- See migration 0053_sync_observability.sql\n\nDROP TABLE IF EXISTS "stripe"."_sync_status";\n',
  },
  {
    name: '0055_bigint_money_columns.sql',
    sql: '-- Fix generated columns: must drop and recreate with ::bigint cast\n-- Money columns that can overflow PostgreSQL integer max (~2.1 billion)\n\n-- checkout_session_line_items\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN "amount_discount";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_discount" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_discount\')::bigint) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN "amount_subtotal";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_subtotal" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_subtotal\')::bigint) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN "amount_tax";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_tax" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_tax\')::bigint) STORED;\nALTER TABLE "stripe"."checkout_session_line_items" DROP COLUMN "amount_total";\nALTER TABLE "stripe"."checkout_session_line_items" ADD COLUMN "amount_total" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_total\')::bigint) STORED;\n\n-- checkout_sessions\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN "amount_subtotal";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "amount_subtotal" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_subtotal\')::bigint) STORED;\nALTER TABLE "stripe"."checkout_sessions" DROP COLUMN "amount_total";\nALTER TABLE "stripe"."checkout_sessions" ADD COLUMN "amount_total" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_total\')::bigint) STORED;\n\n-- credit_notes\nALTER TABLE "stripe"."credit_notes" DROP COLUMN "amount";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount\')::bigint) STORED;\nALTER TABLE "stripe"."credit_notes" DROP COLUMN "amount_shipping";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "amount_shipping" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_shipping\')::bigint) STORED;\nALTER TABLE "stripe"."credit_notes" DROP COLUMN "discount_amount";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "discount_amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'discount_amount\')::bigint) STORED;\nALTER TABLE "stripe"."credit_notes" DROP COLUMN "out_of_band_amount";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "out_of_band_amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'out_of_band_amount\')::bigint) STORED;\nALTER TABLE "stripe"."credit_notes" DROP COLUMN "subtotal";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "subtotal" bigint GENERATED ALWAYS AS ((_raw_data->>\'subtotal\')::bigint) STORED;\nALTER TABLE "stripe"."credit_notes" DROP COLUMN "subtotal_excluding_tax";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "subtotal_excluding_tax" bigint GENERATED ALWAYS AS ((_raw_data->>\'subtotal_excluding_tax\')::bigint) STORED;\nALTER TABLE "stripe"."credit_notes" DROP COLUMN "total";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "total" bigint GENERATED ALWAYS AS ((_raw_data->>\'total\')::bigint) STORED;\nALTER TABLE "stripe"."credit_notes" DROP COLUMN "total_excluding_tax";\nALTER TABLE "stripe"."credit_notes" ADD COLUMN "total_excluding_tax" bigint GENERATED ALWAYS AS ((_raw_data->>\'total_excluding_tax\')::bigint) STORED;\n\n-- customers\nALTER TABLE "stripe"."customers" DROP COLUMN "balance";\nALTER TABLE "stripe"."customers" ADD COLUMN "balance" bigint GENERATED ALWAYS AS ((_raw_data->>\'balance\')::bigint) STORED;\n\n-- invoices\nALTER TABLE "stripe"."invoices" DROP COLUMN "ending_balance";\nALTER TABLE "stripe"."invoices" ADD COLUMN "ending_balance" bigint GENERATED ALWAYS AS ((_raw_data->>\'ending_balance\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" DROP COLUMN "starting_balance";\nALTER TABLE "stripe"."invoices" ADD COLUMN "starting_balance" bigint GENERATED ALWAYS AS ((_raw_data->>\'starting_balance\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" DROP COLUMN "subtotal";\nALTER TABLE "stripe"."invoices" ADD COLUMN "subtotal" bigint GENERATED ALWAYS AS ((_raw_data->>\'subtotal\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" DROP COLUMN "tax";\nALTER TABLE "stripe"."invoices" ADD COLUMN "tax" bigint GENERATED ALWAYS AS ((_raw_data->>\'tax\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" DROP COLUMN "post_payment_credit_notes_amount";\nALTER TABLE "stripe"."invoices" ADD COLUMN "post_payment_credit_notes_amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'post_payment_credit_notes_amount\')::bigint) STORED;\nALTER TABLE "stripe"."invoices" DROP COLUMN "pre_payment_credit_notes_amount";\nALTER TABLE "stripe"."invoices" ADD COLUMN "pre_payment_credit_notes_amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'pre_payment_credit_notes_amount\')::bigint) STORED;\n\n-- payment_intents\nALTER TABLE "stripe"."payment_intents" DROP COLUMN "amount";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount\')::bigint) STORED;\nALTER TABLE "stripe"."payment_intents" DROP COLUMN "amount_capturable";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount_capturable" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_capturable\')::bigint) STORED;\nALTER TABLE "stripe"."payment_intents" DROP COLUMN "amount_received";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "amount_received" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount_received\')::bigint) STORED;\nALTER TABLE "stripe"."payment_intents" DROP COLUMN "application_fee_amount";\nALTER TABLE "stripe"."payment_intents" ADD COLUMN "application_fee_amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'application_fee_amount\')::bigint) STORED;\n\n-- prices\nALTER TABLE "stripe"."prices" DROP COLUMN "unit_amount";\nALTER TABLE "stripe"."prices" ADD COLUMN "unit_amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'unit_amount\')::bigint) STORED;\n\n-- refunds\nALTER TABLE "stripe"."refunds" DROP COLUMN "amount";\nALTER TABLE "stripe"."refunds" ADD COLUMN "amount" bigint GENERATED ALWAYS AS ((_raw_data->>\'amount\')::bigint) STORED;\n',
  },
  {
    name: '0056_sync_run_closed_at.sql',
    sql: '-- Add closed_at column to _sync_run\n-- closed_at IS NULL means the run is still active\n-- Status is derived from object states when closed_at IS NOT NULL\n\n-- Step 1: Drop dependent view first\nDROP VIEW IF EXISTS "stripe"."sync_dashboard";\n\n-- Step 2: Drop the old constraint, status column, and completed_at column\nALTER TABLE "stripe"."_sync_run" DROP CONSTRAINT IF EXISTS one_active_run_per_account;\nALTER TABLE "stripe"."_sync_run" DROP COLUMN IF EXISTS status;\nALTER TABLE "stripe"."_sync_run" DROP COLUMN IF EXISTS completed_at;\n\n-- Step 3: Add closed_at column\nALTER TABLE "stripe"."_sync_run" ADD COLUMN IF NOT EXISTS closed_at TIMESTAMPTZ;\n\n-- Step 4: Create exclusion constraint (only one active run per account)\nALTER TABLE "stripe"."_sync_run"\nADD CONSTRAINT one_active_run_per_account\nEXCLUDE ("_account_id" WITH =) WHERE (closed_at IS NULL);\n\n-- Step 5: Recreate sync_dashboard view (run-level only, one row per run)\n-- Base table: _sync_run (parent sync operation)\n-- Child table: _sync_obj_run (individual object syncs)\nCREATE OR REPLACE VIEW "stripe"."sync_dashboard" AS\nSELECT\n  run."_account_id" as account_id,\n  run.started_at,\n  run.closed_at,\n  run.max_concurrent,\n  run.triggered_by,\n  run.updated_at,\n  -- Derived status from object states\n  CASE\n    WHEN run.closed_at IS NULL THEN \'running\'\n    WHEN EXISTS (\n      SELECT 1 FROM "stripe"."_sync_obj_run" obj\n      WHERE obj."_account_id" = run."_account_id"\n        AND obj.run_started_at = run.started_at\n        AND obj.status = \'error\'\n    ) THEN \'error\'\n    ELSE \'complete\'\n  END as status,\n  -- First error message from failed objects\n  (SELECT obj.error_message FROM "stripe"."_sync_obj_run" obj\n   WHERE obj."_account_id" = run."_account_id"\n     AND obj.run_started_at = run.started_at\n     AND obj.status = \'error\'\n   ORDER BY obj.object LIMIT 1) as error_message,\n  -- Total processed count across all objects\n  COALESCE((SELECT SUM(obj.processed_count) FROM "stripe"."_sync_obj_run" obj\n   WHERE obj."_account_id" = run."_account_id"\n     AND obj.run_started_at = run.started_at), 0) as processed_count\nFROM "stripe"."_sync_run" run;\n',
  },
  {
    name: '0057_rename_sync_tables.sql',
    sql: '-- Rename sync observability tables and create public sync_runs view\n-- Internal tables use _ prefix, public view is sync_runs\n\n-- Step 1: Drop the old sync_dashboard view\nDROP VIEW IF EXISTS "stripe"."sync_dashboard";\n\n-- Step 2: Rename tables to plural (keep _ prefix for internal tables)\nALTER TABLE "stripe"."_sync_run" RENAME TO "_sync_runs";\nALTER TABLE "stripe"."_sync_obj_run" RENAME TO "_sync_obj_runs";\n\n-- Step 3: Update foreign key constraint name\nALTER TABLE "stripe"."_sync_obj_runs"\n  DROP CONSTRAINT IF EXISTS fk_sync_obj_run_parent;\n\nALTER TABLE "stripe"."_sync_obj_runs"\n  ADD CONSTRAINT fk_sync_obj_runs_parent\n    FOREIGN KEY ("_account_id", run_started_at)\n    REFERENCES "stripe"."_sync_runs" ("_account_id", started_at);\n\n-- Step 4: Recreate indexes with new table names\nDROP INDEX IF EXISTS "stripe"."idx_sync_run_account_status";\nDROP INDEX IF EXISTS "stripe"."idx_sync_obj_run_status";\n\nCREATE INDEX idx_sync_runs_account_status\n  ON "stripe"."_sync_runs" ("_account_id", closed_at);\n\nCREATE INDEX idx_sync_obj_runs_status\n  ON "stripe"."_sync_obj_runs" ("_account_id", run_started_at, status);\n\n-- Step 5: Create public sync_runs view (one row per run with aggregates)\nCREATE VIEW "stripe"."sync_runs" AS\nSELECT\n  r._account_id as account_id,\n  r.started_at,\n  r.closed_at,\n  r.triggered_by,\n  r.max_concurrent,\n  -- Aggregate metrics from child objects\n  COALESCE(SUM(o.processed_count), 0) as total_processed,\n  COUNT(o.*) as total_objects,\n  COUNT(*) FILTER (WHERE o.status = \'complete\') as complete_count,\n  COUNT(*) FILTER (WHERE o.status = \'error\') as error_count,\n  COUNT(*) FILTER (WHERE o.status = \'running\') as running_count,\n  COUNT(*) FILTER (WHERE o.status = \'pending\') as pending_count,\n  -- Collect error messages if any\n  STRING_AGG(o.error_message, \'; \') FILTER (WHERE o.error_message IS NOT NULL) as error_message,\n  -- Derive overall status from run state and object states\n  CASE\n    WHEN r.closed_at IS NULL THEN \'running\'\n    WHEN COUNT(*) FILTER (WHERE o.status = \'error\') > 0 THEN \'error\'\n    ELSE \'complete\'\n  END as status\nFROM "stripe"."_sync_runs" r\nLEFT JOIN "stripe"."_sync_obj_runs" o\n  ON o._account_id = r._account_id\n  AND o.run_started_at = r.started_at\nGROUP BY r._account_id, r.started_at, r.closed_at, r.triggered_by, r.max_concurrent;\n',
  },
  {
    name: '0058_improve_sync_runs_status.sql',
    sql: "-- Improve sync_runs view status logic\n-- More granular status based on actual object run states\n\nDROP VIEW IF EXISTS \"stripe\".\"sync_runs\";\n\nCREATE VIEW \"stripe\".\"sync_runs\" AS\nSELECT\n  r._account_id as account_id,\n  r.started_at,\n  r.closed_at,\n  r.triggered_by,\n  r.max_concurrent,\n  -- Aggregate metrics from child objects\n  COALESCE(SUM(o.processed_count), 0) as total_processed,\n  COUNT(o.*) as total_objects,\n  COUNT(*) FILTER (WHERE o.status = 'complete') as complete_count,\n  COUNT(*) FILTER (WHERE o.status = 'error') as error_count,\n  COUNT(*) FILTER (WHERE o.status = 'running') as running_count,\n  COUNT(*) FILTER (WHERE o.status = 'pending') as pending_count,\n  -- Collect error messages if any\n  STRING_AGG(o.error_message, '; ') FILTER (WHERE o.error_message IS NOT NULL) as error_message,\n  -- Derive overall status from run state and object states\n  CASE\n    -- Run still open (closed_at IS NULL)\n    WHEN r.closed_at IS NULL AND COUNT(*) FILTER (WHERE o.status = 'running') > 0 THEN 'running'\n    WHEN r.closed_at IS NULL AND (COUNT(o.*) = 0 OR COUNT(o.*) = COUNT(*) FILTER (WHERE o.status = 'pending')) THEN 'pending'\n    WHEN r.closed_at IS NULL THEN 'running'\n    -- Run closed (closed_at IS NOT NULL)\n    WHEN COUNT(*) FILTER (WHERE o.status = 'error') > 0 THEN 'error'\n    ELSE 'complete'\n  END as status\nFROM \"stripe\".\"_sync_runs\" r\nLEFT JOIN \"stripe\".\"_sync_obj_runs\" o\n  ON o._account_id = r._account_id\n  AND o.run_started_at = r.started_at\nGROUP BY r._account_id, r.started_at, r.closed_at, r.triggered_by, r.max_concurrent;\n",
  },
  {
    name: '0059_sigma_subscription_item_change_events_v2_beta.sql',
    sql: '-- event_timestamp and event_type are not generated columns because they are not immutable. \n-- Postgres requires generated expressions to be immutable.\n\nCREATE TABLE IF NOT EXISTS "stripe"."subscription_item_change_events_v2_beta" (\n  "_raw_data" jsonb NOT NULL,\n  "_last_synced_at" timestamptz,\n  "_updated_at" timestamptz DEFAULT now(),\n  "_account_id" text NOT NULL,\n\n  "event_timestamp" timestamptz NOT NULL,\n  "event_type" text NOT NULL,\n  "subscription_item_id" text NOT NULL,\n\n  PRIMARY KEY ("_account_id", "event_timestamp", "event_type", "subscription_item_id")\n);\n\n-- Foreign key to stripe.accounts\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  DROP CONSTRAINT IF EXISTS fk_subscription_item_change_events_v2_beta_account;\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD CONSTRAINT fk_subscription_item_change_events_v2_beta_account\n  FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\n\n-- Maintain _updated_at on UPDATE\nDROP TRIGGER IF EXISTS handle_updated_at ON "stripe"."subscription_item_change_events_v2_beta";\nCREATE TRIGGER handle_updated_at\n  BEFORE UPDATE ON "stripe"."subscription_item_change_events_v2_beta"\n  FOR EACH ROW EXECUTE FUNCTION set_updated_at();\n\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD COLUMN IF NOT EXISTS "currency" text\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'currency\', \'\'))::text) STORED;\n\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD COLUMN IF NOT EXISTS "mrr_change" bigint\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'mrr_change\', \'\'))::bigint) STORED;\n\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD COLUMN IF NOT EXISTS "quantity_change" bigint\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'quantity_change\', \'\'))::bigint) STORED;\n\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD COLUMN IF NOT EXISTS "subscription_id" text\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'subscription_id\', \'\'))::text) STORED;\n\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD COLUMN IF NOT EXISTS "customer_id" text\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'customer_id\', \'\'))::text) STORED;\n\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD COLUMN IF NOT EXISTS "price_id" text\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'price_id\', \'\'))::text) STORED;\n\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD COLUMN IF NOT EXISTS "product_id" text\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'product_id\', \'\'))::text) STORED;\n\n-- Keep as text to avoid non-immutable timestamp casts in a generated column\nALTER TABLE "stripe"."subscription_item_change_events_v2_beta"\n  ADD COLUMN IF NOT EXISTS "local_event_timestamp" text\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'local_event_timestamp\', \'\'))::text) STORED;',
  },
  {
    name: '0060_sigma_exchange_rates_from_usd.sql',
    sql: '\nCREATE TABLE IF NOT EXISTS "stripe"."exchange_rates_from_usd" (\n  "_raw_data" jsonb NOT NULL,\n  "_last_synced_at" timestamptz,\n  "_updated_at" timestamptz DEFAULT now(),\n  "_account_id" text NOT NULL,\n\n  "date" date NOT NULL,\n  "sell_currency" text NOT NULL,\n\n  PRIMARY KEY ("_account_id", "date", "sell_currency")\n);\n\n-- Foreign key to stripe.accounts\nALTER TABLE "stripe"."exchange_rates_from_usd"\n  DROP CONSTRAINT IF EXISTS fk_exchange_rates_from_usd_account;\nALTER TABLE "stripe"."exchange_rates_from_usd"\n  ADD CONSTRAINT fk_exchange_rates_from_usd_account\n  FOREIGN KEY ("_account_id") REFERENCES "stripe"."accounts" (id);\n\n-- Maintain _updated_at on UPDATE\nDROP TRIGGER IF EXISTS handle_updated_at ON "stripe"."exchange_rates_from_usd";\nCREATE TRIGGER handle_updated_at\n  BEFORE UPDATE ON "stripe"."exchange_rates_from_usd"\n  FOR EACH ROW EXECUTE FUNCTION set_updated_at();\n\nALTER TABLE "stripe"."exchange_rates_from_usd"\n  ADD COLUMN IF NOT EXISTS "buy_currency_exchange_rates" text\n    GENERATED ALWAYS AS ((NULLIF(_raw_data->>\'buy_currency_exchange_rates\', \'\'))::text) STORED;\n\n-- Index on date for efficient range queries\nCREATE INDEX IF NOT EXISTS idx_exchange_rates_from_usd_date\n  ON "stripe"."exchange_rates_from_usd" ("date");\n\n-- Index on sell_currency for filtering by currency\nCREATE INDEX IF NOT EXISTS idx_exchange_rates_from_usd_sell_currency\n  ON "stripe"."exchange_rates_from_usd" ("sell_currency");\n\n',
  },
  {
    name: '0061_add_page_cursor.sql',
    sql: '-- Add page_cursor column for pagination state within a single sync run.\n-- This is used to store the starting_after ID for backfills using Stripe list calls.\nALTER TABLE "stripe"."_sync_obj_runs" ADD COLUMN IF NOT EXISTS page_cursor text;\n',
  },
  {
    name: '0062_sigma_query_runs.sql',
    sql: '-- Allow parallel sync runs per triggered_by (sigma-worker vs stripe-worker)\nALTER TABLE "stripe"."_sync_runs" DROP CONSTRAINT IF EXISTS one_active_run_per_account;\nALTER TABLE "stripe"."_sync_runs"\nADD CONSTRAINT one_active_run_per_account_triggered_by\nEXCLUDE (\n  "_account_id" WITH =,\n  COALESCE(triggered_by, \'default\') WITH =\n) WHERE (closed_at IS NULL);\n',
  },
  {
    name: '0063_drop_sigma_subscription_item_and_exchange_rate_tables.sql',
    sql: '-- Drop unused sigma beta tables if they exist.\nDROP TABLE IF EXISTS "stripe"."subscription_item_change_events_v2_beta";\nDROP TABLE IF EXISTS "stripe"."exchange_rates_from_usd";\n',
  },
  {
    name: '0064_add_created_gte_lte.sql',
    sql: '-- Add created_gte / created_lte columns for time-range partitioned parallel sync.\n-- Workers use these to scope their Stripe list calls to a specific created window.\n-- Stored as Unix epoch seconds (INTEGER) to match Stripe\'s created filter format.\n-- created_gte defaults to 0 for non-chunked rows (required by PK).\nALTER TABLE "stripe"."_sync_obj_runs" ADD COLUMN IF NOT EXISTS created_gte INTEGER NOT NULL DEFAULT 0;\nALTER TABLE "stripe"."_sync_obj_runs" ADD COLUMN IF NOT EXISTS created_lte INTEGER;\n\n-- Expand PK to include created_gte so multiple time-range chunks of the same object can coexist.\n-- PK constraint kept original name from 0053 (_sync_obj_run_pkey) after table rename in 0057.\nALTER TABLE "stripe"."_sync_obj_runs" DROP CONSTRAINT IF EXISTS "_sync_obj_runs_pkey";\nALTER TABLE "stripe"."_sync_obj_runs" DROP CONSTRAINT IF EXISTS "_sync_obj_run_pkey";\nALTER TABLE "stripe"."_sync_obj_runs"\n  ADD CONSTRAINT "_sync_obj_runs_pkey" PRIMARY KEY ("_account_id", run_started_at, object, created_gte);\n',
  },
  {
    name: '0065_add_created_lte_to_pk.sql',
    sql: '-- Include created_lte in the PK so chunks with the same created_gte but\n-- different created_lte can coexist.  Requires a NOT NULL default first.\nALTER TABLE "stripe"."_sync_obj_runs"\n  ALTER COLUMN created_lte SET DEFAULT 0;\n\nUPDATE "stripe"."_sync_obj_runs"\n   SET created_lte = 0\n WHERE created_lte IS NULL;\n\nALTER TABLE "stripe"."_sync_obj_runs"\n  ALTER COLUMN created_lte SET NOT NULL;\n\nALTER TABLE "stripe"."_sync_obj_runs" DROP CONSTRAINT IF EXISTS "_sync_obj_runs_pkey";\nALTER TABLE "stripe"."_sync_obj_runs"\n  ADD CONSTRAINT "_sync_obj_runs_pkey" PRIMARY KEY ("_account_id", run_started_at, object, created_gte, created_lte);\n',
  },
  {
    name: '0066_rate_limits.sql',
    sql: '-- Rate limiting table and function for cross-process request throttling.\n-- Used by claimNextTask to cap how many claims/sec hit the database.\n\nCREATE TABLE IF NOT EXISTS "stripe"."_rate_limits" (\n  key TEXT PRIMARY KEY,\n  count INTEGER NOT NULL DEFAULT 0,\n  window_start TIMESTAMPTZ NOT NULL DEFAULT now()\n);\n\nCREATE OR REPLACE FUNCTION "stripe".check_rate_limit(\n  rate_key TEXT,\n  max_requests INTEGER,\n  window_seconds INTEGER\n)\nRETURNS VOID AS $$\nDECLARE\n  now TIMESTAMPTZ := clock_timestamp();\n  window_length INTERVAL := make_interval(secs => window_seconds);\n  current_count INTEGER;\nBEGIN\n  PERFORM pg_advisory_xact_lock(hashtext(rate_key));\n\n  INSERT INTO "stripe"."_rate_limits" (key, count, window_start)\n  VALUES (rate_key, 1, now)\n  ON CONFLICT (key) DO UPDATE\n  SET count = CASE\n                WHEN "_rate_limits".window_start + window_length <= now\n                  THEN 1\n                  ELSE "_rate_limits".count + 1\n              END,\n      window_start = CASE\n                       WHEN "_rate_limits".window_start + window_length <= now\n                         THEN now\n                         ELSE "_rate_limits".window_start\n                     END;\n\n  SELECT count INTO current_count FROM "stripe"."_rate_limits" WHERE key = rate_key;\n\n  IF current_count > max_requests THEN\n    RAISE EXCEPTION \'Rate limit exceeded for %\', rate_key;\n  END IF;\nEND;\n$$ LANGUAGE plpgsql;\n',
  },
  {
    name: '0067_add_priority_to_sync_obj_runs.sql',
    sql: '-- Add priority column to _sync_obj_runs for deterministic task ordering.\n-- Priority mirrors the `order` field from resourceRegistry so workers\n-- always process parent resources (products, prices) before children\n-- (subscriptions, invoices).\n\nALTER TABLE "stripe"."_sync_obj_runs"\n  ADD COLUMN IF NOT EXISTS priority INTEGER NOT NULL DEFAULT 0;\n\nCREATE INDEX IF NOT EXISTS idx_sync_obj_runs_priority\n  ON "stripe"."_sync_obj_runs" ("_account_id", run_started_at, status, priority);\n',
  },
  {
    name: '0068_sync_obj_progress_view.sql',
    sql: '-- Per-object sync progress view for monitoring.\n-- Defaults to the newest run per account; callers can filter by a specific\n-- run_started_at if needed.\n\nDROP FUNCTION IF EXISTS "stripe"."sync_obj_progress"(TEXT, TIMESTAMPTZ);\n\nCREATE OR REPLACE VIEW "stripe"."sync_obj_progress" AS\nSELECT\n  r."_account_id" AS account_id,\n  r.run_started_at,\n  r.object,\n  ROUND(\n    100.0 * COUNT(*) FILTER (WHERE r.status = \'complete\') / NULLIF(COUNT(*), 0),\n    1\n  ) AS pct_complete,\n  COALESCE(SUM(r.processed_count), 0) AS processed\nFROM "stripe"."_sync_obj_runs" r\nWHERE r.run_started_at = (\n  SELECT MAX(s.started_at)\n  FROM "stripe"."_sync_runs" s\n  WHERE s."_account_id" = r."_account_id"\n)\nGROUP BY r."_account_id", r.run_started_at, r.object;\n',
  },
  {
    name: '0069_add_account_id_to_coupons.sql',
    sql: 'ALTER TABLE "stripe"."coupons" ADD COLUMN IF NOT EXISTS "_account_id" TEXT;',
  },
]
